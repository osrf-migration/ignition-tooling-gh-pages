{"links": {"self": {"href": "data/repositories/osrf/release-tools/pullrequests/243/comments/19160423.json"}, "html": {"href": "#!/osrf/release-tools/pull-requests/243/_/diff#comment-19160423"}}, "parent": {"id": 19056940, "links": {"self": {"href": "data/repositories/osrf/release-tools/pullrequests/243/comments/19056940.json"}, "html": {"href": "#!/osrf/release-tools/pull-requests/243/_/diff#comment-19056940"}}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 243, "links": {"self": {"href": "data/repositories/osrf/release-tools/pullrequests/243.json"}, "html": {"href": "#!/osrf/release-tools/pull-requests/243"}}, "title": "Upload brew bottles to non versioned destination in S3"}, "content": {"raw": "You are right, this PR changes are totally broken.\n\nFor incorporate the changes into the DSL we face the problem of handling the `$PACKAGE`variable, which is a job parameter and does not exists out of the scope of the jobs so it is not visible for DSL code, the following won't work since `PACKAGE` is not a variable for Groovy.\n\n```\n#!diff\n--- a/jenkins-scripts/dsl/core.dsl\tSat May 28 01:54:43 2016 +0200\n+++ b/jenkins-scripts/dsl/core.dsl\tWed Jun 01 01:08:37 2016 +0200\n@@ -159,6 +159,8 @@\n    publishers {\n      archiveArtifacts(\"${directory_for_bottles}/*\")\n \n+     package_canonical = PACKAGE.replaceAll('[0-9]*$', '');\n+\n      // call to the repository_uploader_ng to upload to S3 the binary\n      downstreamParameterized\n      {\n@@ -167,7 +169,7 @@\n           parameters {\n             currentBuild()\n               predefinedProp(\"PROJECT_NAME_TO_COPY_ARTIFACTS\", \"\\${JOB_NAME}\")\n-              predefinedProp(\"S3_UPLOAD_PATH\", \"\\${PACKAGE}/releases\")\n+              predefinedProp(\"S3_UPLOAD_PATH\", \"\\${package_canonical}/releases/\")\n               predefinedProp(\"UPLOAD_TO_REPO\", \"only_s3_upload\")\n               predefinedProp(\"ARCH\",           \"64bits\")\n           }\n```\n\nI hack something using the system groovy jenkins engine which can access to almost every data in the system. I run a fake test in [this job](http://build.osrfoundation.org/view/All/job/_test_dsl_playground/)", "markup": "markdown", "html": "<p>You are right, this PR changes are totally broken.</p>\n<p>For incorporate the changes into the DSL we face the problem of handling the <code>$PACKAGE</code>variable, which is a job parameter and does not exists out of the scope of the jobs so it is not visible for DSL code, the following won't work since <code>PACKAGE</code> is not a variable for Groovy.</p>\n<div class=\"codehilite language-diff\"><pre><span></span><span class=\"gd\">--- a/jenkins-scripts/dsl/core.dsl  Sat May 28 01:54:43 2016 +0200</span>\n<span class=\"gi\">+++ b/jenkins-scripts/dsl/core.dsl  Wed Jun 01 01:08:37 2016 +0200</span>\n<span class=\"gu\">@@ -159,6 +159,8 @@</span>\n    publishers {\n      archiveArtifacts(&quot;${directory_for_bottles}/*&quot;)\n\n<span class=\"gi\">+     package_canonical = PACKAGE.replaceAll(&#39;[0-9]*$&#39;, &#39;&#39;);</span>\n<span class=\"gi\">+</span>\n      // call to the repository_uploader_ng to upload to S3 the binary\n      downstreamParameterized\n      {\n<span class=\"gu\">@@ -167,7 +169,7 @@</span>\n           parameters {\n             currentBuild()\n               predefinedProp(&quot;PROJECT_NAME_TO_COPY_ARTIFACTS&quot;, &quot;\\${JOB_NAME}&quot;)\n<span class=\"gd\">-              predefinedProp(&quot;S3_UPLOAD_PATH&quot;, &quot;\\${PACKAGE}/releases&quot;)</span>\n<span class=\"gi\">+              predefinedProp(&quot;S3_UPLOAD_PATH&quot;, &quot;\\${package_canonical}/releases/&quot;)</span>\n               predefinedProp(&quot;UPLOAD_TO_REPO&quot;, &quot;only_s3_upload&quot;)\n               predefinedProp(&quot;ARCH&quot;,           &quot;64bits&quot;)\n           }\n</pre></div>\n\n\n<p>I hack something using the system groovy jenkins engine which can access to almost every data in the system. I run a fake test in <a data-is-external-link=\"true\" href=\"http://build.osrfoundation.org/view/All/job/_test_dsl_playground/\" rel=\"nofollow\">this job</a></p>", "type": "rendered"}, "created_on": "2016-05-31T23:38:32.088589+00:00", "user": {"display_name": "Jose Luis Rivero", "uuid": "{d12309b2-f745-42ee-b119-aec4fcdf81fe}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bd12309b2-f745-42ee-b119-aec4fcdf81fe%7D"}, "html": {"href": "https://bitbucket.org/%7Bd12309b2-f745-42ee-b119-aec4fcdf81fe%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/109284c8b83411dbc7492138f6167e9ed=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsJR-5.png"}}, "nickname": "Jose Luis Rivero", "type": "user", "account_id": "557058:155a32e2-420c-4d50-98e0-0e722f63f906"}, "updated_on": "2016-05-31T23:38:32.092637+00:00", "type": "pullrequest_comment", "id": 19160423}