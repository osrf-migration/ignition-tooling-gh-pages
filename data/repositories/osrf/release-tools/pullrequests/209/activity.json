{"pagelen": 50, "values": [{"update": {"description": "## Summary\r\n\r\nThis PR adds a form of flaky test detection to the gazebo homebrew build (for gazebo7 and up, since older versions of gazebo have many failing tests) by re-running failed tests one time to see if they fail both times (issue #60). This makes use of the `--rerun-failed` argument to ctest, which requires cmake 3+. This is available on homebrew and vivid+ but not trusty by default.\r\n\r\nWhen re-running the failed tests, the `test_results` folder needs to be shuffled and the new junit files merged with the previous version using the `flaky_junit_merge.py` script from previous pull requests. The information about flaky tests can be visualized with the jenkins flaky test plugin, which is already installed in jenkins and is enabled in the dsl with this pull request. [Here's an example of a build with flaky test information](http://build.osrfoundation.org/view/main/view/CI%20any%20jobs/job/ignition_math-ci-pr_any-homebrew-amd64/45/testReport/%28root%29/). Unfortunately it doesn't display anything on the It doesn't display anything on the\r\n[Test Results summary page](http://build.osrfoundation.org/view/main/view/CI%20any%20jobs/job/ignition_math-ci-pr_any-homebrew-amd64/45/testReport/),\r\nbut if you click on\r\n[(root)](http://build.osrfoundation.org/view/main/view/CI%20any%20jobs/job/ignition_math-ci-pr_any-homebrew-amd64/45/testReport/%28root%29/)\r\nit will show info about flaky tests.\r\nLook for a storm cloud to see tests that didn't pass perfectly.\r\n\r\nOne concern about the flaky test plugin is that I have observed some jenkins failures in the gazebo test builds with this branch:\r\n\r\n* http://build.osrfoundation.org/job/gazebo-ci-pr_any-homebrew-amd64/282/\r\n* http://build.osrfoundation.org/job/gazebo-ci-pr_any-homebrew-amd64/284/\r\n\r\n~~~\r\nRecording test results\r\nERROR: Build step failed with exception\r\njava.lang.NullPointerException\r\n\tat java.io.File.<init>(File.java:277)\r\n\tat com.google.jenkins.flakyTestHandler.junit.FlakyTestResult.<init>(FlakyTestResult.java:120)\r\n~~~\r\n\r\nI rebooted the machine and am watching to see if this failure recurs.\r\n\r\n## Tests that fail to run\r\n\r\nThe `flaky_junit_merge.py` script was updated in pull request #214 to resolve #65.\r\n\r\nOne challenge with tests that fail to run is that `ctest --rerun-failed` won't re-run the `check_test_ran` script, so we wouldn't know if the test failed on the second try. There is a hack in  5aacd8d with `sed` and `grep` and a `make test` loop that is not pretty but is working.\r\n\r\nHere are some example builds that show flaky versions of `test_ran` from [ign-math branch flaky_rand_test](https://bitbucket.org/ignitionrobotics/ign-math/branches/compare/flaky_rand_test%0Dign-math2#diff):\r\n\r\n* In [run 62](http://build.osrfoundation.org/view/main/view/CI%20any%20jobs/job/ignition_math-ci-pr_any-homebrew-amd64/62/testReport/%28root%29/RandTest/) and [run 63](http://build.osrfoundation.org/view/main/view/CI%20any%20jobs/job/ignition_math-ci-pr_any-homebrew-amd64/63/testReport/%28root%29/RandTest/), the test completes one time and asserts one time. Thus [test_ran](http://build.osrfoundation.org/view/main/view/CI%20any%20jobs/job/ignition_math-ci-pr_any-homebrew-amd64/63/testReport/%28root%29/RandTest/test_ran/) is marked as a flaky pass. Note also that `test_ran` is listed in the same `RandTest` grouping since a matching `classname` is added in the flaky case.\r\n\r\n* In [run 64](http://build.osrfoundation.org/view/main/view/CI%20any%20jobs/job/ignition_math-ci-pr_any-homebrew-amd64/64/testReport/junit/%28root%29/Results/test_ran/), the test fails both times and is listed under the `Results` class as usual.\r\n\r\n", "title": "Rerun failed tests in gazebo homebrew (#60, #65)", "destination": {"commit": {"hash": "b0ea1cb86a84", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/release-tools/commit/b0ea1cb86a84.json"}, "html": {"href": "#!/osrf/release-tools/commits/b0ea1cb86a84"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/release-tools.json"}, "html": {"href": "#!/osrf/release-tools"}, "avatar": {"href": "data/bytebucket.org/ravatar/{41811d3d-19d0-428e-a134-976595e72508}ts=python"}}, "type": "repository", "name": "release-tools", "full_name": "osrf/release-tools", "uuid": "{41811d3d-19d0-428e-a134-976595e72508}"}, "branch": {"name": "default"}}, "reason": "", "source": {"commit": {"hash": "c70f616d8fb7", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/release-tools/commit/c70f616d8fb7.json"}, "html": {"href": "#!/osrf/release-tools/commits/c70f616d8fb7"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/release-tools.json"}, "html": {"href": "#!/osrf/release-tools"}, "avatar": {"href": "data/bytebucket.org/ravatar/{41811d3d-19d0-428e-a134-976595e72508}ts=python"}}, "type": "repository", "name": "release-tools", "full_name": "osrf/release-tools", "uuid": "{41811d3d-19d0-428e-a134-976595e72508}"}, "branch": {"name": "flaky"}}, "state": "MERGED", "author": {"display_name": "Jose Luis Rivero", "uuid": "{d12309b2-f745-42ee-b119-aec4fcdf81fe}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bd12309b2-f745-42ee-b119-aec4fcdf81fe%7D"}, "html": {"href": "https://bitbucket.org/%7Bd12309b2-f745-42ee-b119-aec4fcdf81fe%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/109284c8b83411dbc7492138f6167e9ed=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsJR-5.png"}}, "nickname": "Jose Luis Rivero", "type": "user", "account_id": "557058:155a32e2-420c-4d50-98e0-0e722f63f906"}, "date": "2016-04-13T00:24:15.097622+00:00"}, "pull_request": {"type": "pullrequest", "id": 209, "links": {"self": {"href": "data/repositories/osrf/release-tools/pullrequests/209.json"}, "html": {"href": "#!/osrf/release-tools/pull-requests/209"}}, "title": "Rerun failed tests in gazebo homebrew (#60, #65)"}}, {"approval": {"date": "2016-04-13T00:24:07.300057+00:00", "pullrequest": {"type": "pullrequest", "id": 209, "links": {"self": {"href": "data/repositories/osrf/release-tools/pullrequests/209.json"}, "html": {"href": "#!/osrf/release-tools/pull-requests/209"}}, "title": "Rerun failed tests in gazebo homebrew (#60, #65)"}, "user": {"display_name": "Jose Luis Rivero", "uuid": "{d12309b2-f745-42ee-b119-aec4fcdf81fe}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bd12309b2-f745-42ee-b119-aec4fcdf81fe%7D"}, "html": {"href": "https://bitbucket.org/%7Bd12309b2-f745-42ee-b119-aec4fcdf81fe%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/109284c8b83411dbc7492138f6167e9ed=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsJR-5.png"}}, "nickname": "Jose Luis Rivero", "type": "user", "account_id": "557058:155a32e2-420c-4d50-98e0-0e722f63f906"}}, "pull_request": {"type": "pullrequest", "id": 209, "links": {"self": {"href": "data/repositories/osrf/release-tools/pullrequests/209.json"}, "html": {"href": "#!/osrf/release-tools/pull-requests/209"}}, "title": "Rerun failed tests in gazebo homebrew (#60, #65)"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/release-tools/pullrequests/209/comments/17144318.json"}, "html": {"href": "#!/osrf/release-tools/pull-requests/209/_/diff#comment-17144318"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 209, "links": {"self": {"href": "data/repositories/osrf/release-tools/pullrequests/209.json"}, "html": {"href": "#!/osrf/release-tools/pull-requests/209"}}, "title": "Rerun failed tests in gazebo homebrew (#60, #65)"}, "content": {"raw": "After all the work ... let's go for it!", "markup": "markdown", "html": "<p>After all the work ... let's go for it!</p>", "type": "rendered"}, "created_on": "2016-04-13T00:24:02.647663+00:00", "user": {"display_name": "Jose Luis Rivero", "uuid": "{d12309b2-f745-42ee-b119-aec4fcdf81fe}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bd12309b2-f745-42ee-b119-aec4fcdf81fe%7D"}, "html": {"href": "https://bitbucket.org/%7Bd12309b2-f745-42ee-b119-aec4fcdf81fe%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/109284c8b83411dbc7492138f6167e9ed=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsJR-5.png"}}, "nickname": "Jose Luis Rivero", "type": "user", "account_id": "557058:155a32e2-420c-4d50-98e0-0e722f63f906"}, "updated_on": "2016-04-13T00:24:02.649917+00:00", "type": "pullrequest_comment", "id": 17144318}, "pull_request": {"type": "pullrequest", "id": 209, "links": {"self": {"href": "data/repositories/osrf/release-tools/pullrequests/209.json"}, "html": {"href": "#!/osrf/release-tools/pull-requests/209"}}, "title": "Rerun failed tests in gazebo homebrew (#60, #65)"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/release-tools/pullrequests/209/comments/17127729.json"}, "html": {"href": "#!/osrf/release-tools/pull-requests/209/_/diff#comment-17127729"}}, "parent": {"id": 17127396, "links": {"self": {"href": "data/repositories/osrf/release-tools/pullrequests/209/comments/17127396.json"}, "html": {"href": "#!/osrf/release-tools/pull-requests/209/_/diff#comment-17127396"}}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 209, "links": {"self": {"href": "data/repositories/osrf/release-tools/pullrequests/209.json"}, "html": {"href": "#!/osrf/release-tools/pull-requests/209"}}, "title": "Rerun failed tests in gazebo homebrew (#60, #65)"}, "content": {"raw": "single quotes: `make test ARGS='-VV -R INTEGRATION_world$'` is also not working but `ctest -R INTEGRATION_world$` is working fine. So your guess is right, something in the pass to ctest is making it not to work.", "markup": "markdown", "html": "<p>single quotes: <code>make test ARGS='-VV -R INTEGRATION_world$'</code> is also not working but <code>ctest -R INTEGRATION_world$</code> is working fine. So your guess is right, something in the pass to ctest is making it not to work.</p>", "type": "rendered"}, "created_on": "2016-04-12T17:58:46.676062+00:00", "user": {"display_name": "Jose Luis Rivero", "uuid": "{d12309b2-f745-42ee-b119-aec4fcdf81fe}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bd12309b2-f745-42ee-b119-aec4fcdf81fe%7D"}, "html": {"href": "https://bitbucket.org/%7Bd12309b2-f745-42ee-b119-aec4fcdf81fe%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/109284c8b83411dbc7492138f6167e9ed=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsJR-5.png"}}, "nickname": "Jose Luis Rivero", "type": "user", "account_id": "557058:155a32e2-420c-4d50-98e0-0e722f63f906"}, "inline": {}, "updated_on": "2016-04-12T17:58:46.679204+00:00", "type": "pullrequest_comment", "id": 17127729}, "pull_request": {"type": "pullrequest", "id": 209, "links": {"self": {"href": "data/repositories/osrf/release-tools/pullrequests/209.json"}, "html": {"href": "#!/osrf/release-tools/pull-requests/209"}}, "title": "Rerun failed tests in gazebo homebrew (#60, #65)"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/release-tools/pullrequests/209/comments/17127396.json"}, "html": {"href": "#!/osrf/release-tools/pull-requests/209/_/diff#comment-17127396"}}, "parent": {"id": 17127005, "links": {"self": {"href": "data/repositories/osrf/release-tools/pullrequests/209/comments/17127005.json"}, "html": {"href": "#!/osrf/release-tools/pull-requests/209/_/diff#comment-17127005"}}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 209, "links": {"self": {"href": "data/repositories/osrf/release-tools/pullrequests/209.json"}, "html": {"href": "#!/osrf/release-tools/pull-requests/209"}}, "title": "Rerun failed tests in gazebo homebrew (#60, #65)"}, "content": {"raw": "my guess is that it's in double quotes, then gets passed to ctest, so it just needs some extra packaging", "markup": "markdown", "html": "<p>my guess is that it's in double quotes, then gets passed to ctest, so it just needs some extra packaging</p>", "type": "rendered"}, "created_on": "2016-04-12T17:51:44.012799+00:00", "user": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "inline": {}, "updated_on": "2016-04-12T17:51:44.015107+00:00", "type": "pullrequest_comment", "id": 17127396}, "pull_request": {"type": "pullrequest", "id": 209, "links": {"self": {"href": "data/repositories/osrf/release-tools/pullrequests/209.json"}, "html": {"href": "#!/osrf/release-tools/pull-requests/209"}}, "title": "Rerun failed tests in gazebo homebrew (#60, #65)"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/release-tools/pullrequests/209/comments/17127005.json"}, "html": {"href": "#!/osrf/release-tools/pull-requests/209/_/diff#comment-17127005"}}, "parent": {"id": 17076386, "links": {"self": {"href": "data/repositories/osrf/release-tools/pullrequests/209/comments/17076386.json"}, "html": {"href": "#!/osrf/release-tools/pull-requests/209/_/diff#comment-17076386"}}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 209, "links": {"self": {"href": "data/repositories/osrf/release-tools/pullrequests/209.json"}, "html": {"href": "#!/osrf/release-tools/pull-requests/209"}}, "title": "Rerun failed tests in gazebo homebrew (#60, #65)"}, "content": {"raw": "you are right, I don't know the reason (nor I can find it) about why a double dollar sign is needed.", "markup": "markdown", "html": "<p>you are right, I don't know the reason (nor I can find it) about why a double dollar sign is needed.</p>", "type": "rendered"}, "created_on": "2016-04-12T17:43:04.108664+00:00", "user": {"display_name": "Jose Luis Rivero", "uuid": "{d12309b2-f745-42ee-b119-aec4fcdf81fe}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bd12309b2-f745-42ee-b119-aec4fcdf81fe%7D"}, "html": {"href": "https://bitbucket.org/%7Bd12309b2-f745-42ee-b119-aec4fcdf81fe%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/109284c8b83411dbc7492138f6167e9ed=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsJR-5.png"}}, "nickname": "Jose Luis Rivero", "type": "user", "account_id": "557058:155a32e2-420c-4d50-98e0-0e722f63f906"}, "inline": {}, "updated_on": "2016-04-12T17:43:04.114719+00:00", "type": "pullrequest_comment", "id": 17127005}, "pull_request": {"type": "pullrequest", "id": 209, "links": {"self": {"href": "data/repositories/osrf/release-tools/pullrequests/209.json"}, "html": {"href": "#!/osrf/release-tools/pull-requests/209"}}, "title": "Rerun failed tests in gazebo homebrew (#60, #65)"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/release-tools/pullrequests/209/comments/17124966.json"}, "html": {"href": "#!/osrf/release-tools/pull-requests/209/_/diff#comment-17124966"}}, "parent": {"id": 17076369, "links": {"self": {"href": "data/repositories/osrf/release-tools/pullrequests/209/comments/17076369.json"}, "html": {"href": "#!/osrf/release-tools/pull-requests/209/_/diff#comment-17076369"}}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 209, "links": {"self": {"href": "data/repositories/osrf/release-tools/pullrequests/209.json"}, "html": {"href": "#!/osrf/release-tools/pull-requests/209"}}, "title": "Rerun failed tests in gazebo homebrew (#60, #65)"}, "content": {"raw": "I'm afraid that I can not find a simpler solution easily. Let's live with it by now.", "markup": "markdown", "html": "<p>I'm afraid that I can not find a simpler solution easily. Let's live with it by now.</p>", "type": "rendered"}, "created_on": "2016-04-12T17:06:07.746060+00:00", "user": {"display_name": "Jose Luis Rivero", "uuid": "{d12309b2-f745-42ee-b119-aec4fcdf81fe}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bd12309b2-f745-42ee-b119-aec4fcdf81fe%7D"}, "html": {"href": "https://bitbucket.org/%7Bd12309b2-f745-42ee-b119-aec4fcdf81fe%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/109284c8b83411dbc7492138f6167e9ed=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsJR-5.png"}}, "nickname": "Jose Luis Rivero", "type": "user", "account_id": "557058:155a32e2-420c-4d50-98e0-0e722f63f906"}, "inline": {}, "updated_on": "2016-04-12T17:06:07.748406+00:00", "type": "pullrequest_comment", "id": 17124966}, "pull_request": {"type": "pullrequest", "id": 209, "links": {"self": {"href": "data/repositories/osrf/release-tools/pullrequests/209.json"}, "html": {"href": "#!/osrf/release-tools/pull-requests/209"}}, "title": "Rerun failed tests in gazebo homebrew (#60, #65)"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/release-tools/pullrequests/209/comments/17076386.json"}, "html": {"href": "#!/osrf/release-tools/pull-requests/209/_/diff#comment-17076386"}}, "parent": {"id": 17076258, "links": {"self": {"href": "data/repositories/osrf/release-tools/pullrequests/209/comments/17076258.json"}, "html": {"href": "#!/osrf/release-tools/pull-requests/209/_/diff#comment-17076258"}}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 209, "links": {"self": {"href": "data/repositories/osrf/release-tools/pullrequests/209.json"}, "html": {"href": "#!/osrf/release-tools/pull-requests/209"}}, "title": "Rerun failed tests in gazebo homebrew (#60, #65)"}, "content": {"raw": "it's to match the end of the line\n\nfor example, if the `INTEGRATION_world` test fails, a naive regex would also match `INTEGRATION_world_clone` and other tests. So I wanted to add the `$` character to the regex. Through trial and error, it had to be with `\\$$`, nothing else would match how I wanted", "markup": "markdown", "html": "<p>it's to match the end of the line</p>\n<p>for example, if the <code>INTEGRATION_world</code> test fails, a naive regex would also match <code>INTEGRATION_world_clone</code> and other tests. So I wanted to add the <code>$</code> character to the regex. Through trial and error, it had to be with <code>\\$$</code>, nothing else would match how I wanted</p>", "type": "rendered"}, "created_on": "2016-04-12T00:10:53.642264+00:00", "user": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "inline": {}, "updated_on": "2016-04-12T00:10:53.644238+00:00", "type": "pullrequest_comment", "id": 17076386}, "pull_request": {"type": "pullrequest", "id": 209, "links": {"self": {"href": "data/repositories/osrf/release-tools/pullrequests/209.json"}, "html": {"href": "#!/osrf/release-tools/pull-requests/209"}}, "title": "Rerun failed tests in gazebo homebrew (#60, #65)"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/release-tools/pullrequests/209/comments/17076369.json"}, "html": {"href": "#!/osrf/release-tools/pull-requests/209/_/diff#comment-17076369"}}, "parent": {"id": 17076288, "links": {"self": {"href": "data/repositories/osrf/release-tools/pullrequests/209/comments/17076288.json"}, "html": {"href": "#!/osrf/release-tools/pull-requests/209/_/diff#comment-17076288"}}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 209, "links": {"self": {"href": "data/repositories/osrf/release-tools/pullrequests/209.json"}, "html": {"href": "#!/osrf/release-tools/pull-requests/209"}}, "title": "Rerun failed tests in gazebo homebrew (#60, #65)"}, "content": {"raw": "separate lines:\n\n~~~\nFailed tests:\n++ ctest -N --rerun-failed\nTest project /Users/jenkins/workspace/gazebo-ci-pr_any-homebrew-amd64_flaky/build\n  Test  #21: UNIT_Rand_TEST\n  Test #113: UNIT_BuildingEditor_TEST\n  Test #119: UNIT_GLWidget_TEST\n  Test #121: UNIT_GLWidget_TEST2\n  ...\n  Test #443: INTEGRATION_model_editor\n  Test #445: INTEGRATION_model_manipulation\n  Test #447: INTEGRATION_undo\n  Test #449: INTEGRATION_visual_pose\n\nTotal Tests: 51\n~~~", "markup": "markdown", "html": "<p>separate lines:</p>\n<div class=\"codehilite\"><pre><span></span>Failed tests:\n++ ctest -N --rerun-failed\nTest project /Users/jenkins/workspace/gazebo-ci-pr_any-homebrew-amd64_flaky/build\n  Test  #21: UNIT_Rand_TEST\n  Test #113: UNIT_BuildingEditor_TEST\n  Test #119: UNIT_GLWidget_TEST\n  Test #121: UNIT_GLWidget_TEST2\n  ...\n  Test #443: INTEGRATION_model_editor\n  Test #445: INTEGRATION_model_manipulation\n  Test #447: INTEGRATION_undo\n  Test #449: INTEGRATION_visual_pose\n\nTotal Tests: 51\n</pre></div>", "type": "rendered"}, "created_on": "2016-04-12T00:09:35.942849+00:00", "user": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "inline": {}, "updated_on": "2016-04-12T00:09:35.945209+00:00", "type": "pullrequest_comment", "id": 17076369}, "pull_request": {"type": "pullrequest", "id": 209, "links": {"self": {"href": "data/repositories/osrf/release-tools/pullrequests/209.json"}, "html": {"href": "#!/osrf/release-tools/pull-requests/209"}}, "title": "Rerun failed tests in gazebo homebrew (#60, #65)"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/release-tools/pullrequests/209/comments/17076288.json"}, "html": {"href": "#!/osrf/release-tools/pull-requests/209/_/diff#comment-17076288"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 209, "links": {"self": {"href": "data/repositories/osrf/release-tools/pullrequests/209.json"}, "html": {"href": "#!/osrf/release-tools/pull-requests/209"}}, "title": "Rerun failed tests in gazebo homebrew (#60, #65)"}, "content": {"raw": "FAILED_TESTS is returning a list with test names separated by ... space? break of lines?", "markup": "markdown", "html": "<p>FAILED_TESTS is returning a list with test names separated by ... space? break of lines?</p>", "type": "rendered"}, "created_on": "2016-04-12T00:04:31.725241+00:00", "user": {"display_name": "Jose Luis Rivero", "uuid": "{d12309b2-f745-42ee-b119-aec4fcdf81fe}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bd12309b2-f745-42ee-b119-aec4fcdf81fe%7D"}, "html": {"href": "https://bitbucket.org/%7Bd12309b2-f745-42ee-b119-aec4fcdf81fe%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/109284c8b83411dbc7492138f6167e9ed=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsJR-5.png"}}, "nickname": "Jose Luis Rivero", "type": "user", "account_id": "557058:155a32e2-420c-4d50-98e0-0e722f63f906"}, "inline": {}, "updated_on": "2016-04-12T00:04:31.727857+00:00", "type": "pullrequest_comment", "id": 17076288}, "pull_request": {"type": "pullrequest", "id": 209, "links": {"self": {"href": "data/repositories/osrf/release-tools/pullrequests/209.json"}, "html": {"href": "#!/osrf/release-tools/pull-requests/209"}}, "title": "Rerun failed tests in gazebo homebrew (#60, #65)"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/release-tools/pullrequests/209/comments/17076258.json"}, "html": {"href": "#!/osrf/release-tools/pull-requests/209/_/diff#comment-17076258"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 209, "links": {"self": {"href": "data/repositories/osrf/release-tools/pullrequests/209.json"}, "html": {"href": "#!/osrf/release-tools/pull-requests/209"}}, "title": "Rerun failed tests in gazebo homebrew (#60, #65)"}, "content": {"raw": "Out of curiosity: why we need a double $?", "markup": "markdown", "html": "<p>Out of curiosity: why we need a double $?</p>", "type": "rendered"}, "created_on": "2016-04-12T00:03:20.448583+00:00", "user": {"display_name": "Jose Luis Rivero", "uuid": "{d12309b2-f745-42ee-b119-aec4fcdf81fe}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bd12309b2-f745-42ee-b119-aec4fcdf81fe%7D"}, "html": {"href": "https://bitbucket.org/%7Bd12309b2-f745-42ee-b119-aec4fcdf81fe%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/109284c8b83411dbc7492138f6167e9ed=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsJR-5.png"}}, "nickname": "Jose Luis Rivero", "type": "user", "account_id": "557058:155a32e2-420c-4d50-98e0-0e722f63f906"}, "inline": {}, "updated_on": "2016-04-12T00:03:20.453757+00:00", "type": "pullrequest_comment", "id": 17076258}, "pull_request": {"type": "pullrequest", "id": 209, "links": {"self": {"href": "data/repositories/osrf/release-tools/pullrequests/209.json"}, "html": {"href": "#!/osrf/release-tools/pull-requests/209"}}, "title": "Rerun failed tests in gazebo homebrew (#60, #65)"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/release-tools/pullrequests/209/comments/17075796.json"}, "html": {"href": "#!/osrf/release-tools/pull-requests/209/_/diff#comment-17075796"}}, "parent": {"id": 17065452, "links": {"self": {"href": "data/repositories/osrf/release-tools/pullrequests/209/comments/17065452.json"}, "html": {"href": "#!/osrf/release-tools/pull-requests/209/_/diff#comment-17065452"}}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 209, "links": {"self": {"href": "data/repositories/osrf/release-tools/pullrequests/209.json"}, "html": {"href": "#!/osrf/release-tools/pull-requests/209"}}, "title": "Rerun failed tests in gazebo homebrew (#60, #65)"}, "content": {"raw": "the ugliest part is the `make test` loop\n\nI don't know how to make it better though", "markup": "markdown", "html": "<p>the ugliest part is the <code>make test</code> loop</p>\n<p>I don't know how to make it better though</p>", "type": "rendered"}, "created_on": "2016-04-11T23:43:26.342434+00:00", "user": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "updated_on": "2016-04-11T23:43:26.345408+00:00", "type": "pullrequest_comment", "id": 17075796}, "pull_request": {"type": "pullrequest", "id": 209, "links": {"self": {"href": "data/repositories/osrf/release-tools/pullrequests/209.json"}, "html": {"href": "#!/osrf/release-tools/pull-requests/209"}}, "title": "Rerun failed tests in gazebo homebrew (#60, #65)"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/release-tools/pullrequests/209/comments/17075774.json"}, "html": {"href": "#!/osrf/release-tools/pull-requests/209/_/diff#comment-17075774"}}, "parent": {"id": 17075502, "links": {"self": {"href": "data/repositories/osrf/release-tools/pullrequests/209/comments/17075502.json"}, "html": {"href": "#!/osrf/release-tools/pull-requests/209/_/diff#comment-17075502"}}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 209, "links": {"self": {"href": "data/repositories/osrf/release-tools/pullrequests/209.json"}, "html": {"href": "#!/osrf/release-tools/pull-requests/209"}}, "title": "Rerun failed tests in gazebo homebrew (#60, #65)"}, "content": {"raw": "thanks!", "markup": "markdown", "html": "<p>thanks!</p>", "type": "rendered"}, "created_on": "2016-04-11T23:42:47.407766+00:00", "user": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "updated_on": "2016-04-11T23:42:47.410735+00:00", "type": "pullrequest_comment", "id": 17075774}, "pull_request": {"type": "pullrequest", "id": 209, "links": {"self": {"href": "data/repositories/osrf/release-tools/pullrequests/209.json"}, "html": {"href": "#!/osrf/release-tools/pull-requests/209"}}, "title": "Rerun failed tests in gazebo homebrew (#60, #65)"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/release-tools/pullrequests/209/comments/17075502.json"}, "html": {"href": "#!/osrf/release-tools/pull-requests/209/_/diff#comment-17075502"}}, "parent": {"id": 17031495, "links": {"self": {"href": "data/repositories/osrf/release-tools/pullrequests/209/comments/17031495.json"}, "html": {"href": "#!/osrf/release-tools/pull-requests/209/_/diff#comment-17031495"}}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 209, "links": {"self": {"href": "data/repositories/osrf/release-tools/pullrequests/209.json"}, "html": {"href": "#!/osrf/release-tools/pull-requests/209"}}, "title": "Rerun failed tests in gazebo homebrew (#60, #65)"}, "content": {"raw": "nice debugging!", "markup": "markdown", "html": "<p>nice debugging!</p>", "type": "rendered"}, "created_on": "2016-04-11T23:32:04.486104+00:00", "user": {"display_name": "Jose Luis Rivero", "uuid": "{d12309b2-f745-42ee-b119-aec4fcdf81fe}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bd12309b2-f745-42ee-b119-aec4fcdf81fe%7D"}, "html": {"href": "https://bitbucket.org/%7Bd12309b2-f745-42ee-b119-aec4fcdf81fe%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/109284c8b83411dbc7492138f6167e9ed=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsJR-5.png"}}, "nickname": "Jose Luis Rivero", "type": "user", "account_id": "557058:155a32e2-420c-4d50-98e0-0e722f63f906"}, "updated_on": "2016-04-11T23:32:04.490984+00:00", "type": "pullrequest_comment", "id": 17075502}, "pull_request": {"type": "pullrequest", "id": 209, "links": {"self": {"href": "data/repositories/osrf/release-tools/pullrequests/209.json"}, "html": {"href": "#!/osrf/release-tools/pull-requests/209"}}, "title": "Rerun failed tests in gazebo homebrew (#60, #65)"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/release-tools/pullrequests/209/comments/17065452.json"}, "html": {"href": "#!/osrf/release-tools/pull-requests/209/_/diff#comment-17065452"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 209, "links": {"self": {"href": "data/repositories/osrf/release-tools/pullrequests/209.json"}, "html": {"href": "#!/osrf/release-tools/pull-requests/209"}}, "title": "Rerun failed tests in gazebo homebrew (#60, #65)"}, "content": {"raw": "I think this is ready for review now", "markup": "markdown", "html": "<p>I think this is ready for review now</p>", "type": "rendered"}, "created_on": "2016-04-11T19:16:37.348008+00:00", "user": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "updated_on": "2016-04-11T19:16:37.351130+00:00", "type": "pullrequest_comment", "id": 17065452}, "pull_request": {"type": "pullrequest", "id": 209, "links": {"self": {"href": "data/repositories/osrf/release-tools/pullrequests/209.json"}, "html": {"href": "#!/osrf/release-tools/pull-requests/209"}}, "title": "Rerun failed tests in gazebo homebrew (#60, #65)"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/release-tools/pullrequests/209/comments/17031495.json"}, "html": {"href": "#!/osrf/release-tools/pull-requests/209/_/diff#comment-17031495"}}, "parent": {"id": 17003871, "links": {"self": {"href": "data/repositories/osrf/release-tools/pullrequests/209/comments/17003871.json"}, "html": {"href": "#!/osrf/release-tools/pull-requests/209/_/diff#comment-17003871"}}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 209, "links": {"self": {"href": "data/repositories/osrf/release-tools/pullrequests/209.json"}, "html": {"href": "#!/osrf/release-tools/pull-requests/209"}}, "title": "Rerun failed tests in gazebo homebrew (#60, #65)"}, "content": {"raw": "I've updated check_test_ran.py in [gazebo pull request #2253](https://bitbucket.org/osrf/gazebo/pull-requests/2253/reduce-jenkins-console-log-size-fix/diff)", "markup": "markdown", "html": "<p>I've updated check_test_ran.py in <a data-is-external-link=\"true\" href=\"https://bitbucket.org/osrf/gazebo/pull-requests/2253/reduce-jenkins-console-log-size-fix/diff\" rel=\"nofollow\">gazebo pull request #2253</a></p>", "type": "rendered"}, "created_on": "2016-04-11T09:15:31.218493+00:00", "user": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "updated_on": "2016-04-11T09:15:31.221565+00:00", "type": "pullrequest_comment", "id": 17031495}, "pull_request": {"type": "pullrequest", "id": 209, "links": {"self": {"href": "data/repositories/osrf/release-tools/pullrequests/209.json"}, "html": {"href": "#!/osrf/release-tools/pull-requests/209"}}, "title": "Rerun failed tests in gazebo homebrew (#60, #65)"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/release-tools/pullrequests/209/comments/17028003.json"}, "html": {"href": "#!/osrf/release-tools/pull-requests/209/_/diff#comment-17028003"}}, "parent": {"id": 17003871, "links": {"self": {"href": "data/repositories/osrf/release-tools/pullrequests/209/comments/17003871.json"}, "html": {"href": "#!/osrf/release-tools/pull-requests/209/_/diff#comment-17003871"}}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 209, "links": {"self": {"href": "data/repositories/osrf/release-tools/pullrequests/209.json"}, "html": {"href": "#!/osrf/release-tools/pull-requests/209"}}, "title": "Rerun failed tests in gazebo homebrew (#60, #65)"}, "content": {"raw": "Since discovering that QTest's can write empty junit xml files when they seg-fault, I've updated the `flaky_junit_merge.py` script to catch xml parsing errors and write the same `test_ran` junit failure that the `check_test_ran.py` script generates. I've also added a blank `input4.xml` example file.", "markup": "markdown", "html": "<p>Since discovering that QTest's can write empty junit xml files when they seg-fault, I've updated the <code>flaky_junit_merge.py</code> script to catch xml parsing errors and write the same <code>test_ran</code> junit failure that the <code>check_test_ran.py</code> script generates. I've also added a blank <code>input4.xml</code> example file.</p>", "type": "rendered"}, "created_on": "2016-04-11T08:06:51.670124+00:00", "user": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "updated_on": "2016-04-11T08:06:51.675314+00:00", "type": "pullrequest_comment", "id": 17028003}, "pull_request": {"type": "pullrequest", "id": 209, "links": {"self": {"href": "data/repositories/osrf/release-tools/pullrequests/209.json"}, "html": {"href": "#!/osrf/release-tools/pull-requests/209"}}, "title": "Rerun failed tests in gazebo homebrew (#60, #65)"}}, {"update": {"description": "## Summary\r\n\r\nThis PR adds a form of flaky test detection to the gazebo homebrew build (for gazebo7 and up, since older versions of gazebo have many failing tests) by re-running failed tests one time to see if they fail both times (issue #60). This makes use of the `--rerun-failed` argument to ctest, which requires cmake 3+. This is available on homebrew and vivid+ but not trusty by default.\r\n\r\nWhen re-running the failed tests, the `test_results` folder needs to be shuffled and the new junit files merged with the previous version using the `flaky_junit_merge.py` script from previous pull requests. The information about flaky tests can be visualized with the jenkins flaky test plugin, which is already installed in jenkins and is enabled in the dsl with this pull request. [Here's an example of a build with flaky test information](http://build.osrfoundation.org/view/main/view/CI%20any%20jobs/job/ignition_math-ci-pr_any-homebrew-amd64/45/testReport/%28root%29/). Unfortunately it doesn't display anything on the It doesn't display anything on the\r\n[Test Results summary page](http://build.osrfoundation.org/view/main/view/CI%20any%20jobs/job/ignition_math-ci-pr_any-homebrew-amd64/45/testReport/),\r\nbut if you click on\r\n[(root)](http://build.osrfoundation.org/view/main/view/CI%20any%20jobs/job/ignition_math-ci-pr_any-homebrew-amd64/45/testReport/%28root%29/)\r\nit will show info about flaky tests.\r\nLook for a storm cloud to see tests that didn't pass perfectly.\r\n\r\nOne concern about the flaky test plugin is that I have observed some jenkins failures in the gazebo test builds with this branch:\r\n\r\n* http://build.osrfoundation.org/job/gazebo-ci-pr_any-homebrew-amd64/282/\r\n* http://build.osrfoundation.org/job/gazebo-ci-pr_any-homebrew-amd64/284/\r\n\r\n~~~\r\nRecording test results\r\nERROR: Build step failed with exception\r\njava.lang.NullPointerException\r\n\tat java.io.File.<init>(File.java:277)\r\n\tat com.google.jenkins.flakyTestHandler.junit.FlakyTestResult.<init>(FlakyTestResult.java:120)\r\n~~~\r\n\r\nI rebooted the machine and am watching to see if this failure recurs.\r\n\r\n## Tests that fail to run\r\n\r\nThe `flaky_junit_merge.py` script was updated in pull request #214 to resolve #65.\r\n\r\nOne challenge with tests that fail to run is that `ctest --rerun-failed` won't re-run the `check_test_ran` script, so we wouldn't know if the test failed on the second try. There is a hack in  5aacd8d with `sed` and `grep` and a `make test` loop that is not pretty but is working.\r\n\r\nHere are some example builds that show flaky versions of `test_ran` from [ign-math branch flaky_rand_test](https://bitbucket.org/ignitionrobotics/ign-math/branches/compare/flaky_rand_test%0Dign-math2#diff):\r\n\r\n* In [run 62](http://build.osrfoundation.org/view/main/view/CI%20any%20jobs/job/ignition_math-ci-pr_any-homebrew-amd64/62/testReport/%28root%29/RandTest/) and [run 63](http://build.osrfoundation.org/view/main/view/CI%20any%20jobs/job/ignition_math-ci-pr_any-homebrew-amd64/63/testReport/%28root%29/RandTest/), the test completes one time and asserts one time. Thus [test_ran](http://build.osrfoundation.org/view/main/view/CI%20any%20jobs/job/ignition_math-ci-pr_any-homebrew-amd64/63/testReport/%28root%29/RandTest/test_ran/) is marked as a flaky pass. Note also that `test_ran` is listed in the same `RandTest` grouping since a matching `classname` is added in the flaky case.\r\n\r\n* In [run 64](http://build.osrfoundation.org/view/main/view/CI%20any%20jobs/job/ignition_math-ci-pr_any-homebrew-amd64/64/testReport/junit/%28root%29/Results/test_ran/), the test fails both times and is listed under the `Results` class as usual.\r\n\r\n", "title": "Rerun failed tests in gazebo homebrew (#60, #65)", "destination": {"commit": {"hash": "60285a04b881", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/release-tools/commit/60285a04b881.json"}, "html": {"href": "#!/osrf/release-tools/commits/60285a04b881"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/release-tools.json"}, "html": {"href": "#!/osrf/release-tools"}, "avatar": {"href": "data/bytebucket.org/ravatar/{41811d3d-19d0-428e-a134-976595e72508}ts=python"}}, "type": "repository", "name": "release-tools", "full_name": "osrf/release-tools", "uuid": "{41811d3d-19d0-428e-a134-976595e72508}"}, "branch": {"name": "default"}}, "reason": "", "source": {"commit": {"hash": "c70f616d8fb7", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/release-tools/commit/c70f616d8fb7.json"}, "html": {"href": "#!/osrf/release-tools/commits/c70f616d8fb7"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/release-tools.json"}, "html": {"href": "#!/osrf/release-tools"}, "avatar": {"href": "data/bytebucket.org/ravatar/{41811d3d-19d0-428e-a134-976595e72508}ts=python"}}, "type": "repository", "name": "release-tools", "full_name": "osrf/release-tools", "uuid": "{41811d3d-19d0-428e-a134-976595e72508}"}, "branch": {"name": "flaky"}}, "state": "OPEN", "author": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "date": "2016-04-11T07:55:58.930722+00:00"}, "pull_request": {"type": "pullrequest", "id": 209, "links": {"self": {"href": "data/repositories/osrf/release-tools/pullrequests/209.json"}, "html": {"href": "#!/osrf/release-tools/pull-requests/209"}}, "title": "Rerun failed tests in gazebo homebrew (#60, #65)"}}, {"update": {"description": "## Summary\r\n\r\nThis PR adds a form of flaky test detection to the gazebo homebrew build (for gazebo7 and up, since older versions of gazebo have many failing tests) by re-running failed tests one time to see if they fail both times (issue #60). This makes use of the `--rerun-failed` argument to ctest, which requires cmake 3+. This is available on homebrew and vivid+ but not trusty by default.\r\n\r\nWhen re-running the failed tests, the `test_results` folder needs to be shuffled and the new junit files merged with the previous version using the `flaky_junit_merge.py` script from previous pull requests. The information about flaky tests can be visualized with the jenkins flaky test plugin, which is already installed in jenkins and is enabled in the dsl with this pull request. [Here's an example of a build with flaky test information](http://build.osrfoundation.org/view/main/view/CI%20any%20jobs/job/ignition_math-ci-pr_any-homebrew-amd64/45/testReport/%28root%29/). Unfortunately it doesn't display anything on the It doesn't display anything on the\r\n[Test Results summary page](http://build.osrfoundation.org/view/main/view/CI%20any%20jobs/job/ignition_math-ci-pr_any-homebrew-amd64/45/testReport/),\r\nbut if you click on\r\n[(root)](http://build.osrfoundation.org/view/main/view/CI%20any%20jobs/job/ignition_math-ci-pr_any-homebrew-amd64/45/testReport/%28root%29/)\r\nit will show info about flaky tests.\r\nLook for a storm cloud to see tests that didn't pass perfectly.\r\n\r\nOne concern about the flaky test plugin is that I have observed some jenkins failures in the gazebo test builds with this branch:\r\n\r\n* http://build.osrfoundation.org/job/gazebo-ci-pr_any-homebrew-amd64/282/\r\n* http://build.osrfoundation.org/job/gazebo-ci-pr_any-homebrew-amd64/284/\r\n\r\n~~~\r\nRecording test results\r\nERROR: Build step failed with exception\r\njava.lang.NullPointerException\r\n\tat java.io.File.<init>(File.java:277)\r\n\tat com.google.jenkins.flakyTestHandler.junit.FlakyTestResult.<init>(FlakyTestResult.java:120)\r\n~~~\r\n\r\nI rebooted the machine and am watching to see if this failure recurs.\r\n\r\n## Tests that fail to run\r\n\r\nThe `flaky_junit_merge.py` script was updated in pull request #214 to resolve #65.\r\n\r\nOne challenge with tests that fail to run is that `ctest --rerun-failed` won't re-run the `check_test_ran` script, so we wouldn't know if the test failed on the second try. There is a hack in  5aacd8d with `sed` and `grep` and a `make test` loop that is not pretty but is working.\r\n\r\nHere are some example builds that show flaky versions of `test_ran` from [ign-math branch flaky_rand_test](https://bitbucket.org/ignitionrobotics/ign-math/branches/compare/flaky_rand_test%0Dign-math2#diff):\r\n\r\n* In [run 62](http://build.osrfoundation.org/view/main/view/CI%20any%20jobs/job/ignition_math-ci-pr_any-homebrew-amd64/62/testReport/%28root%29/RandTest/) and [run 63](http://build.osrfoundation.org/view/main/view/CI%20any%20jobs/job/ignition_math-ci-pr_any-homebrew-amd64/63/testReport/%28root%29/RandTest/), the test completes one time and asserts one time. Thus [test_ran](http://build.osrfoundation.org/view/main/view/CI%20any%20jobs/job/ignition_math-ci-pr_any-homebrew-amd64/63/testReport/%28root%29/RandTest/test_ran/) is marked as a flaky pass. Note also that `test_ran` is listed in the same `RandTest` grouping since a matching `classname` is added in the flaky case.\r\n\r\n* In [run 64](http://build.osrfoundation.org/view/main/view/CI%20any%20jobs/job/ignition_math-ci-pr_any-homebrew-amd64/64/testReport/junit/%28root%29/Results/test_ran/), the test fails both times and is listed under the `Results` class as usual.\r\n\r\n", "title": "Rerun failed tests in gazebo homebrew (#60, #65)", "destination": {"commit": {"hash": "60285a04b881", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/release-tools/commit/60285a04b881.json"}, "html": {"href": "#!/osrf/release-tools/commits/60285a04b881"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/release-tools.json"}, "html": {"href": "#!/osrf/release-tools"}, "avatar": {"href": "data/bytebucket.org/ravatar/{41811d3d-19d0-428e-a134-976595e72508}ts=python"}}, "type": "repository", "name": "release-tools", "full_name": "osrf/release-tools", "uuid": "{41811d3d-19d0-428e-a134-976595e72508}"}, "branch": {"name": "default"}}, "reason": "", "source": {"commit": {"hash": "29f02dbcf9e8", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/release-tools/commit/29f02dbcf9e8.json"}, "html": {"href": "#!/osrf/release-tools/commits/29f02dbcf9e8"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/release-tools.json"}, "html": {"href": "#!/osrf/release-tools"}, "avatar": {"href": "data/bytebucket.org/ravatar/{41811d3d-19d0-428e-a134-976595e72508}ts=python"}}, "type": "repository", "name": "release-tools", "full_name": "osrf/release-tools", "uuid": "{41811d3d-19d0-428e-a134-976595e72508}"}, "branch": {"name": "flaky"}}, "state": "OPEN", "author": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "date": "2016-04-11T07:30:10.798907+00:00"}, "pull_request": {"type": "pullrequest", "id": 209, "links": {"self": {"href": "data/repositories/osrf/release-tools/pullrequests/209.json"}, "html": {"href": "#!/osrf/release-tools/pull-requests/209"}}, "title": "Rerun failed tests in gazebo homebrew (#60, #65)"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/release-tools/pullrequests/209/comments/17017862.json"}, "html": {"href": "#!/osrf/release-tools/pull-requests/209/_/diff#comment-17017862"}}, "parent": {"id": 17003871, "links": {"self": {"href": "data/repositories/osrf/release-tools/pullrequests/209/comments/17003871.json"}, "html": {"href": "#!/osrf/release-tools/pull-requests/209/_/diff#comment-17003871"}}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 209, "links": {"self": {"href": "data/repositories/osrf/release-tools/pullrequests/209.json"}, "html": {"href": "#!/osrf/release-tools/pull-requests/209"}}, "title": "Rerun failed tests in gazebo homebrew (#60, #65)"}, "content": {"raw": "Breaking news update: I just figured out what the problem has been. The gazebo tests using QTestFixture will create the xml result file immediately and write to it after all the tests have finished. If the test seg-faults or timeouts, however, the xml file will be empty. I believe this was causing the `NullPointerException`s in the flaky test handler plugin.\n\nThe good news is that my pull request prevents the build from failing with `NullPointerException`'s. Those tests are displayed with a `.[empty]` suffix in the list of test results:\n\n* http://build.osrfoundation.org/job/gazebo-ci-pr_any-homebrew-amd64_flaky/14/testReport/\n\nThis testing also showed that the `flaky_junit_merge.py` script doesn't handle empty xml files well, giving `lxml.etree.XMLSyntaxError: None` and [breaking the build](http://build.osrfoundation.org/job/gazebo-ci-pr_any-homebrew-amd64_flaky/13/). So we should update this script.\n\nAlso, we could try fixing the upstream `check_test_ran.py` scripts to make sure they don't just check if a file exists, but also if it is non-empty.", "markup": "markdown", "html": "<p>Breaking news update: I just figured out what the problem has been. The gazebo tests using QTestFixture will create the xml result file immediately and write to it after all the tests have finished. If the test seg-faults or timeouts, however, the xml file will be empty. I believe this was causing the <code>NullPointerException</code>s in the flaky test handler plugin.</p>\n<p>The good news is that my pull request prevents the build from failing with <code>NullPointerException</code>'s. Those tests are displayed with a <code>.[empty]</code> suffix in the list of test results:</p>\n<ul>\n<li><a href=\"http://build.osrfoundation.org/job/gazebo-ci-pr_any-homebrew-amd64_flaky/14/testReport/\" rel=\"nofollow\" class=\"ap-connect-link\">http://build.osrfoundation.org/job/gazebo-ci-pr_any-homebrew-amd64_flaky/14/testReport/</a></li>\n</ul>\n<p>This testing also showed that the <code>flaky_junit_merge.py</code> script doesn't handle empty xml files well, giving <code>lxml.etree.XMLSyntaxError: None</code> and <a data-is-external-link=\"true\" href=\"http://build.osrfoundation.org/job/gazebo-ci-pr_any-homebrew-amd64_flaky/13/\" rel=\"nofollow\">breaking the build</a>. So we should update this script.</p>\n<p>Also, we could try fixing the upstream <code>check_test_ran.py</code> scripts to make sure they don't just check if a file exists, but also if it is non-empty.</p>", "type": "rendered"}, "created_on": "2016-04-10T20:36:11.083957+00:00", "user": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "updated_on": "2016-04-10T20:36:11.086545+00:00", "type": "pullrequest_comment", "id": 17017862}, "pull_request": {"type": "pullrequest", "id": 209, "links": {"self": {"href": "data/repositories/osrf/release-tools/pullrequests/209.json"}, "html": {"href": "#!/osrf/release-tools/pull-requests/209"}}, "title": "Rerun failed tests in gazebo homebrew (#60, #65)"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/release-tools/pullrequests/209/comments/17014396.json"}, "html": {"href": "#!/osrf/release-tools/pull-requests/209/_/diff#comment-17014396"}}, "parent": {"id": 17003871, "links": {"self": {"href": "data/repositories/osrf/release-tools/pullrequests/209/comments/17003871.json"}, "html": {"href": "#!/osrf/release-tools/pull-requests/209/_/diff#comment-17003871"}}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 209, "links": {"self": {"href": "data/repositories/osrf/release-tools/pullrequests/209.json"}, "html": {"href": "#!/osrf/release-tools/pull-requests/209"}}, "title": "Rerun failed tests in gazebo homebrew (#60, #65)"}, "content": {"raw": "Also, I discovered that the jenkins plugin CI provides installable plugins as build artifacts:\n\n* https://jenkins.ci.cloudbees.com/job/plugins/job/flaky-test-handler-plugin/43/org.jenkins-ci.plugins$flaky-test-handler/\n\nI'm testing it now", "markup": "markdown", "html": "<p>Also, I discovered that the jenkins plugin CI provides installable plugins as build artifacts:</p>\n<ul>\n<li><a href=\"https://jenkins.ci.cloudbees.com/job/plugins/job/flaky-test-handler-plugin/43/org.jenkins-ci.plugins$flaky-test-handler/\" rel=\"nofollow\" class=\"ap-connect-link\">https://jenkins.ci.cloudbees.com/job/plugins/job/flaky-test-handler-plugin/43/org.jenkins-ci.plugins$flaky-test-handler/</a></li>\n</ul>\n<p>I'm testing it now</p>", "type": "rendered"}, "created_on": "2016-04-10T09:02:00.743071+00:00", "user": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "updated_on": "2016-04-10T09:02:00.745423+00:00", "type": "pullrequest_comment", "id": 17014396}, "pull_request": {"type": "pullrequest", "id": 209, "links": {"self": {"href": "data/repositories/osrf/release-tools/pullrequests/209.json"}, "html": {"href": "#!/osrf/release-tools/pull-requests/209"}}, "title": "Rerun failed tests in gazebo homebrew (#60, #65)"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/release-tools/pullrequests/209/comments/17003871.json"}, "html": {"href": "#!/osrf/release-tools/pull-requests/209/_/diff#comment-17003871"}}, "parent": {"id": 16828484, "links": {"self": {"href": "data/repositories/osrf/release-tools/pullrequests/209/comments/16828484.json"}, "html": {"href": "#!/osrf/release-tools/pull-requests/209/_/diff#comment-16828484"}}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 209, "links": {"self": {"href": "data/repositories/osrf/release-tools/pullrequests/209.json"}, "html": {"href": "#!/osrf/release-tools/pull-requests/209"}}, "title": "Rerun failed tests in gazebo homebrew (#60, #65)"}, "content": {"raw": "I've submitted a pull request to catch the exception that is dooming our builds:\n\n* https://github.com/jenkinsci/flaky-test-handler-plugin/pull/4\n\nThere is probably another bug somewhere, but at least this should allow it to fail more gracefully.", "markup": "markdown", "html": "<p>I've submitted a pull request to catch the exception that is dooming our builds:</p>\n<ul>\n<li><a href=\"https://github.com/jenkinsci/flaky-test-handler-plugin/pull/4\" rel=\"nofollow\" class=\"ap-connect-link\">https://github.com/jenkinsci/flaky-test-handler-plugin/pull/4</a></li>\n</ul>\n<p>There is probably another bug somewhere, but at least this should allow it to fail more gracefully.</p>", "type": "rendered"}, "created_on": "2016-04-08T21:42:27.163257+00:00", "user": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "updated_on": "2016-04-08T21:42:27.165988+00:00", "type": "pullrequest_comment", "id": 17003871}, "pull_request": {"type": "pullrequest", "id": 209, "links": {"self": {"href": "data/repositories/osrf/release-tools/pullrequests/209.json"}, "html": {"href": "#!/osrf/release-tools/pull-requests/209"}}, "title": "Rerun failed tests in gazebo homebrew (#60, #65)"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/release-tools/pullrequests/209/comments/16999147.json"}, "html": {"href": "#!/osrf/release-tools/pull-requests/209/_/diff#comment-16999147"}}, "parent": {"id": 16828484, "links": {"self": {"href": "data/repositories/osrf/release-tools/pullrequests/209/comments/16828484.json"}, "html": {"href": "#!/osrf/release-tools/pull-requests/209/_/diff#comment-16828484"}}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 209, "links": {"self": {"href": "data/repositories/osrf/release-tools/pullrequests/209.json"}, "html": {"href": "#!/osrf/release-tools/pull-requests/209"}}, "title": "Rerun failed tests in gazebo homebrew (#60, #65)"}, "content": {"raw": "I've been able to reproduce the plugin failure by building the `gazebo6` branch on homebrew:\n\n* http://build.osrfoundation.org/job/gazebo-ci-pr_any-homebrew-amd64_flaky/8/\n* http://build.osrfoundation.org/job/gazebo-ci-pr_any-homebrew-amd64_flaky/9/", "markup": "markdown", "html": "<p>I've been able to reproduce the plugin failure by building the <code>gazebo6</code> branch on homebrew:</p>\n<ul>\n<li><a href=\"http://build.osrfoundation.org/job/gazebo-ci-pr_any-homebrew-amd64_flaky/8/\" rel=\"nofollow\" class=\"ap-connect-link\">http://build.osrfoundation.org/job/gazebo-ci-pr_any-homebrew-amd64_flaky/8/</a></li>\n<li><a href=\"http://build.osrfoundation.org/job/gazebo-ci-pr_any-homebrew-amd64_flaky/9/\" rel=\"nofollow\" class=\"ap-connect-link\">http://build.osrfoundation.org/job/gazebo-ci-pr_any-homebrew-amd64_flaky/9/</a></li>\n</ul>", "type": "rendered"}, "created_on": "2016-04-08T19:17:18.146610+00:00", "user": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "updated_on": "2016-04-08T19:17:18.149441+00:00", "type": "pullrequest_comment", "id": 16999147}, "pull_request": {"type": "pullrequest", "id": 209, "links": {"self": {"href": "data/repositories/osrf/release-tools/pullrequests/209.json"}, "html": {"href": "#!/osrf/release-tools/pull-requests/209"}}, "title": "Rerun failed tests in gazebo homebrew (#60, #65)"}}, {"update": {"description": "## Summary\r\n\r\nThis PR adds a form of flaky test detection to the gazebo homebrew build (for gazebo7 and up, since older versions of gazebo have many failing tests) by re-running failed tests one time to see if they fail both times (issue #60). This makes use of the `--rerun-failed` argument to ctest, which requires cmake 3+. This is available on homebrew and vivid+ but not trusty by default.\r\n\r\nWhen re-running the failed tests, the `test_results` folder needs to be shuffled and the new junit files merged with the previous version using the `flaky_junit_merge.py` script from previous pull requests. The information about flaky tests can be visualized with the jenkins flaky test plugin, which is already installed in jenkins and is enabled in the dsl with this pull request. [Here's an example of a build with flaky test information](http://build.osrfoundation.org/view/main/view/CI%20any%20jobs/job/ignition_math-ci-pr_any-homebrew-amd64/45/testReport/%28root%29/). Unfortunately it doesn't display anything on the It doesn't display anything on the\r\n[Test Results summary page](http://build.osrfoundation.org/view/main/view/CI%20any%20jobs/job/ignition_math-ci-pr_any-homebrew-amd64/45/testReport/),\r\nbut if you click on\r\n[(root)](http://build.osrfoundation.org/view/main/view/CI%20any%20jobs/job/ignition_math-ci-pr_any-homebrew-amd64/45/testReport/%28root%29/)\r\nit will show info about flaky tests.\r\nLook for a storm cloud to see tests that didn't pass perfectly.\r\n\r\nOne concern about the flaky test plugin is that I have observed some jenkins failures in the gazebo test builds with this branch:\r\n\r\n* http://build.osrfoundation.org/job/gazebo-ci-pr_any-homebrew-amd64/282/\r\n* http://build.osrfoundation.org/job/gazebo-ci-pr_any-homebrew-amd64/284/\r\n\r\n~~~\r\nRecording test results\r\nERROR: Build step failed with exception\r\njava.lang.NullPointerException\r\n\tat java.io.File.<init>(File.java:277)\r\n\tat com.google.jenkins.flakyTestHandler.junit.FlakyTestResult.<init>(FlakyTestResult.java:120)\r\n~~~\r\n\r\nI rebooted the machine and am watching to see if this failure recurs.\r\n\r\n## Tests that fail to run\r\n\r\nThe `flaky_junit_merge.py` script was updated in pull request #214 to resolve #65.\r\n\r\nOne challenge with tests that fail to run is that `ctest --rerun-failed` won't re-run the `check_test_ran` script, so we wouldn't know if the test failed on the second try. There is a hack in  5aacd8d with `sed` and `grep` and a `make test` loop that is not pretty but is working.\r\n\r\nHere are some example builds that show flaky versions of `test_ran` from [ign-math branch flaky_rand_test](https://bitbucket.org/ignitionrobotics/ign-math/branches/compare/flaky_rand_test%0Dign-math2#diff):\r\n\r\n* In [run 62](http://build.osrfoundation.org/view/main/view/CI%20any%20jobs/job/ignition_math-ci-pr_any-homebrew-amd64/62/testReport/%28root%29/RandTest/) and [run 63](http://build.osrfoundation.org/view/main/view/CI%20any%20jobs/job/ignition_math-ci-pr_any-homebrew-amd64/63/testReport/%28root%29/RandTest/), the test completes one time and asserts one time. Thus [test_ran](http://build.osrfoundation.org/view/main/view/CI%20any%20jobs/job/ignition_math-ci-pr_any-homebrew-amd64/63/testReport/%28root%29/RandTest/test_ran/) is marked as a flaky pass. Note also that `test_ran` is listed in the same `RandTest` grouping since a matching `classname` is added in the flaky case.\r\n\r\n* In [run 64](http://build.osrfoundation.org/view/main/view/CI%20any%20jobs/job/ignition_math-ci-pr_any-homebrew-amd64/64/testReport/junit/%28root%29/Results/test_ran/), the test fails both times and is listed under the `Results` class as usual.\r\n\r\n", "title": "Rerun failed tests in gazebo homebrew (#60, #65)", "destination": {"commit": {"hash": "c7ee5bc10706", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/release-tools/commit/c7ee5bc10706.json"}, "html": {"href": "#!/osrf/release-tools/commits/c7ee5bc10706"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/release-tools.json"}, "html": {"href": "#!/osrf/release-tools"}, "avatar": {"href": "data/bytebucket.org/ravatar/{41811d3d-19d0-428e-a134-976595e72508}ts=python"}}, "type": "repository", "name": "release-tools", "full_name": "osrf/release-tools", "uuid": "{41811d3d-19d0-428e-a134-976595e72508}"}, "branch": {"name": "default"}}, "reason": "", "source": {"commit": {"hash": "cfcc7ec8ef54", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/release-tools/commit/cfcc7ec8ef54.json"}, "html": {"href": "#!/osrf/release-tools/commits/cfcc7ec8ef54"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/release-tools.json"}, "html": {"href": "#!/osrf/release-tools"}, "avatar": {"href": "data/bytebucket.org/ravatar/{41811d3d-19d0-428e-a134-976595e72508}ts=python"}}, "type": "repository", "name": "release-tools", "full_name": "osrf/release-tools", "uuid": "{41811d3d-19d0-428e-a134-976595e72508}"}, "branch": {"name": "flaky"}}, "state": "OPEN", "author": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "date": "2016-04-07T05:32:34.098938+00:00"}, "pull_request": {"type": "pullrequest", "id": 209, "links": {"self": {"href": "data/repositories/osrf/release-tools/pullrequests/209.json"}, "html": {"href": "#!/osrf/release-tools/pull-requests/209"}}, "title": "Rerun failed tests in gazebo homebrew (#60, #65)"}}, {"update": {"description": "## Summary\r\n\r\nThis PR adds a form of flaky test detection to the gazebo homebrew build (for gazebo7 and up, since older versions of gazebo have many failing tests) by re-running failed tests one time to see if they fail both times (issue #60). This makes use of the `--rerun-failed` argument to ctest, which requires cmake 3+. This is available on homebrew and vivid+ but not trusty by default.\r\n\r\nWhen re-running the failed tests, the `test_results` folder needs to be shuffled and the new junit files merged with the previous version using the `flaky_junit_merge.py` script from previous pull requests. The information about flaky tests can be visualized with the jenkins flaky test plugin, which is already installed in jenkins and is enabled in the dsl with this pull request. [Here's an example of a build with flaky test information](http://build.osrfoundation.org/view/main/view/CI%20any%20jobs/job/ignition_math-ci-pr_any-homebrew-amd64/45/testReport/%28root%29/). Unfortunately it doesn't display anything on the It doesn't display anything on the\r\n[Test Results summary page](http://build.osrfoundation.org/view/main/view/CI%20any%20jobs/job/ignition_math-ci-pr_any-homebrew-amd64/45/testReport/),\r\nbut if you click on\r\n[(root)](http://build.osrfoundation.org/view/main/view/CI%20any%20jobs/job/ignition_math-ci-pr_any-homebrew-amd64/45/testReport/%28root%29/)\r\nit will show info about flaky tests.\r\nLook for a storm cloud to see tests that didn't pass perfectly.\r\n\r\nOne concern about the flaky test plugin is that I have observed some jenkins failures in the gazebo test builds with this branch:\r\n\r\n* http://build.osrfoundation.org/job/gazebo-ci-pr_any-homebrew-amd64/282/\r\n* http://build.osrfoundation.org/job/gazebo-ci-pr_any-homebrew-amd64/284/\r\n\r\n~~~\r\nRecording test results\r\nERROR: Build step failed with exception\r\njava.lang.NullPointerException\r\n\tat java.io.File.<init>(File.java:277)\r\n\tat com.google.jenkins.flakyTestHandler.junit.FlakyTestResult.<init>(FlakyTestResult.java:120)\r\n~~~\r\n\r\nI rebooted the machine and am watching to see if this failure recurs.\r\n\r\n## Tests that fail to run\r\n\r\nThe `flaky_junit_merge.py` script was updated in pull request #214 to resolve #65.\r\n\r\nOne challenge with tests that fail to run is that `ctest --rerun-failed` won't re-run the `check_test_ran` script, so we wouldn't know if the test failed on the second try. There is a hack in  5aacd8d with `sed` and `grep` and a `make test` loop that is not pretty but is working.\r\n\r\nHere are some example builds that show flaky versions of `test_ran` from [ign-math branch flaky_rand_test](https://bitbucket.org/ignitionrobotics/ign-math/branches/compare/flaky_rand_test%0Dign-math2#diff):\r\n\r\n* In [run 62](http://build.osrfoundation.org/view/main/view/CI%20any%20jobs/job/ignition_math-ci-pr_any-homebrew-amd64/62/testReport/%28root%29/RandTest/) and [run 63](http://build.osrfoundation.org/view/main/view/CI%20any%20jobs/job/ignition_math-ci-pr_any-homebrew-amd64/63/testReport/%28root%29/RandTest/), the test completes one time and asserts one time. Thus [test_ran](http://build.osrfoundation.org/view/main/view/CI%20any%20jobs/job/ignition_math-ci-pr_any-homebrew-amd64/63/testReport/%28root%29/RandTest/test_ran/) is marked as a flaky pass. Note also that `test_ran` is listed in the same `RandTest` grouping since a matching `classname` is added in the flaky case.\r\n\r\n* In [run 64](http://build.osrfoundation.org/view/main/view/CI%20any%20jobs/job/ignition_math-ci-pr_any-homebrew-amd64/64/testReport/junit/%28root%29/Results/test_ran/), the test fails both times and is listed under the `Results` class as usual.\r\n\r\n", "title": "Rerun failed tests in gazebo homebrew (#60, #65)", "destination": {"commit": {"hash": "c7ee5bc10706", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/release-tools/commit/c7ee5bc10706.json"}, "html": {"href": "#!/osrf/release-tools/commits/c7ee5bc10706"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/release-tools.json"}, "html": {"href": "#!/osrf/release-tools"}, "avatar": {"href": "data/bytebucket.org/ravatar/{41811d3d-19d0-428e-a134-976595e72508}ts=python"}}, "type": "repository", "name": "release-tools", "full_name": "osrf/release-tools", "uuid": "{41811d3d-19d0-428e-a134-976595e72508}"}, "branch": {"name": "default"}}, "reason": "", "source": {"commit": {"hash": "d2307081aa95", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/release-tools/commit/d2307081aa95.json"}, "html": {"href": "#!/osrf/release-tools/commits/d2307081aa95"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/release-tools.json"}, "html": {"href": "#!/osrf/release-tools"}, "avatar": {"href": "data/bytebucket.org/ravatar/{41811d3d-19d0-428e-a134-976595e72508}ts=python"}}, "type": "repository", "name": "release-tools", "full_name": "osrf/release-tools", "uuid": "{41811d3d-19d0-428e-a134-976595e72508}"}, "branch": {"name": "flaky"}}, "state": "OPEN", "author": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "date": "2016-04-07T03:00:15.593005+00:00"}, "pull_request": {"type": "pullrequest", "id": 209, "links": {"self": {"href": "data/repositories/osrf/release-tools/pullrequests/209.json"}, "html": {"href": "#!/osrf/release-tools/pull-requests/209"}}, "title": "Rerun failed tests in gazebo homebrew (#60, #65)"}}, {"update": {"description": "## Summary\r\n\r\nThis PR adds a form of flaky test detection to the gazebo homebrew build (for gazebo7 and up, since older versions of gazebo have many failing tests) by re-running failed tests one time to see if they fail both times (issue #60). This makes use of the `--rerun-failed` argument to ctest, which requires cmake 3+. This is available on homebrew and vivid+ but not trusty by default.\r\n\r\nWhen re-running the failed tests, the `test_results` folder needs to be shuffled and the new junit files merged with the previous version using the `flaky_junit_merge.py` script from previous pull requests. The information about flaky tests can be visualized with the jenkins flaky test plugin, which is already installed in jenkins and is enabled in the dsl with this pull request. [Here's an example of a build with flaky test information](http://build.osrfoundation.org/view/main/view/CI%20any%20jobs/job/ignition_math-ci-pr_any-homebrew-amd64/45/testReport/%28root%29/). Unfortunately it doesn't display anything on the It doesn't display anything on the\r\n[Test Results summary page](http://build.osrfoundation.org/view/main/view/CI%20any%20jobs/job/ignition_math-ci-pr_any-homebrew-amd64/45/testReport/),\r\nbut if you click on\r\n[(root)](http://build.osrfoundation.org/view/main/view/CI%20any%20jobs/job/ignition_math-ci-pr_any-homebrew-amd64/45/testReport/%28root%29/)\r\nit will show info about flaky tests.\r\nLook for a storm cloud to see tests that didn't pass perfectly.\r\n\r\nOne concern about the flaky test plugin is that I have observed some jenkins failures in the gazebo test builds with this branch:\r\n\r\n* http://build.osrfoundation.org/job/gazebo-ci-pr_any-homebrew-amd64/282/\r\n* http://build.osrfoundation.org/job/gazebo-ci-pr_any-homebrew-amd64/284/\r\n\r\n~~~\r\nRecording test results\r\nERROR: Build step failed with exception\r\njava.lang.NullPointerException\r\n\tat java.io.File.<init>(File.java:277)\r\n\tat com.google.jenkins.flakyTestHandler.junit.FlakyTestResult.<init>(FlakyTestResult.java:120)\r\n~~~\r\n\r\nI rebooted the machine and am watching to see if this failure recurs.\r\n\r\n## Tests that fail to run\r\n\r\nThe `flaky_junit_merge.py` script was updated in pull request #214 to resolve #65.\r\n\r\nOne challenge with tests that fail to run is that `ctest --rerun-failed` won't re-run the `check_test_ran` script, so we wouldn't know if the test failed on the second try. There is a hack in  5aacd8d with `sed` and `grep` and a `make test` loop that is not pretty but is working.\r\n\r\nHere are some example builds that show flaky versions of `test_ran` from [ign-math branch flaky_rand_test](https://bitbucket.org/ignitionrobotics/ign-math/branches/compare/flaky_rand_test%0Dign-math2#diff):\r\n\r\n* In [run 62](http://build.osrfoundation.org/view/main/view/CI%20any%20jobs/job/ignition_math-ci-pr_any-homebrew-amd64/62/testReport/%28root%29/RandTest/) and [run 63](http://build.osrfoundation.org/view/main/view/CI%20any%20jobs/job/ignition_math-ci-pr_any-homebrew-amd64/63/testReport/%28root%29/RandTest/), the test completes one time and asserts one time. Thus [test_ran](http://build.osrfoundation.org/view/main/view/CI%20any%20jobs/job/ignition_math-ci-pr_any-homebrew-amd64/63/testReport/%28root%29/RandTest/test_ran/) is marked as a flaky pass. Note also that `test_ran` is listed in the same `RandTest` grouping since a matching `classname` is added in the flaky case.\r\n\r\n* In [run 64](http://build.osrfoundation.org/view/main/view/CI%20any%20jobs/job/ignition_math-ci-pr_any-homebrew-amd64/64/testReport/junit/%28root%29/Results/test_ran/), the test fails both times and is listed under the `Results` class as usual.\r\n\r\n", "title": "Rerun failed tests in gazebo homebrew (#60, #65)", "destination": {"commit": {"hash": "c7ee5bc10706", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/release-tools/commit/c7ee5bc10706.json"}, "html": {"href": "#!/osrf/release-tools/commits/c7ee5bc10706"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/release-tools.json"}, "html": {"href": "#!/osrf/release-tools"}, "avatar": {"href": "data/bytebucket.org/ravatar/{41811d3d-19d0-428e-a134-976595e72508}ts=python"}}, "type": "repository", "name": "release-tools", "full_name": "osrf/release-tools", "uuid": "{41811d3d-19d0-428e-a134-976595e72508}"}, "branch": {"name": "default"}}, "reason": "", "source": {"commit": {"hash": "df46068fb068", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/release-tools/commit/df46068fb068.json"}, "html": {"href": "#!/osrf/release-tools/commits/df46068fb068"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/release-tools.json"}, "html": {"href": "#!/osrf/release-tools"}, "avatar": {"href": "data/bytebucket.org/ravatar/{41811d3d-19d0-428e-a134-976595e72508}ts=python"}}, "type": "repository", "name": "release-tools", "full_name": "osrf/release-tools", "uuid": "{41811d3d-19d0-428e-a134-976595e72508}"}, "branch": {"name": "flaky"}}, "state": "OPEN", "author": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "date": "2016-04-06T18:41:02.792573+00:00"}, "pull_request": {"type": "pullrequest", "id": 209, "links": {"self": {"href": "data/repositories/osrf/release-tools/pullrequests/209.json"}, "html": {"href": "#!/osrf/release-tools/pull-requests/209"}}, "title": "Rerun failed tests in gazebo homebrew (#60, #65)"}}, {"update": {"description": "## Summary\r\n\r\nThis PR adds a form of flaky test detection to the gazebo homebrew build (for gazebo7 and up, since older versions of gazebo have many failing tests) by re-running failed tests one time to see if they fail both times (issue #60). This makes use of the `--rerun-failed` argument to ctest, which requires cmake 3+. This is available on homebrew and vivid+ but not trusty by default.\r\n\r\nWhen re-running the failed tests, the `test_results` folder needs to be shuffled and the new junit files merged with the previous version using the `flaky_junit_merge.py` script from previous pull requests. The information about flaky tests can be visualized with the jenkins flaky test plugin, which is already installed in jenkins and is enabled in the dsl with this pull request. [Here's an example of a build with flaky test information](http://build.osrfoundation.org/view/main/view/CI%20any%20jobs/job/ignition_math-ci-pr_any-homebrew-amd64/45/testReport/%28root%29/). Unfortunately it doesn't display anything on the It doesn't display anything on the\r\n[Test Results summary page](http://build.osrfoundation.org/view/main/view/CI%20any%20jobs/job/ignition_math-ci-pr_any-homebrew-amd64/45/testReport/),\r\nbut if you click on\r\n[(root)](http://build.osrfoundation.org/view/main/view/CI%20any%20jobs/job/ignition_math-ci-pr_any-homebrew-amd64/45/testReport/%28root%29/)\r\nit will show info about flaky tests.\r\nLook for a storm cloud to see tests that didn't pass perfectly.\r\n\r\nOne concern about the flaky test plugin is that I have observed some jenkins failures in the gazebo test builds with this branch:\r\n\r\n* http://build.osrfoundation.org/job/gazebo-ci-pr_any-homebrew-amd64/282/\r\n* http://build.osrfoundation.org/job/gazebo-ci-pr_any-homebrew-amd64/284/\r\n\r\n~~~\r\nRecording test results\r\nERROR: Build step failed with exception\r\njava.lang.NullPointerException\r\n\tat java.io.File.<init>(File.java:277)\r\n\tat com.google.jenkins.flakyTestHandler.junit.FlakyTestResult.<init>(FlakyTestResult.java:120)\r\n~~~\r\n\r\nI rebooted the machine and am watching to see if this failure recurs.\r\n\r\n## Tests that fail to run\r\n\r\nThe `flaky_junit_merge.py` script was updated in pull request #214 to resolve #65.\r\n\r\nOne challenge with tests that fail to run is that `ctest --rerun-failed` won't re-run the `check_test_ran` script, so we wouldn't know if the test failed on the second try. There is a hack in  5aacd8d with `sed` and `grep` and a `make test` loop that is not pretty but is working.\r\n\r\nHere are some example builds that show flaky versions of `test_ran` from [ign-math branch flaky_rand_test](https://bitbucket.org/ignitionrobotics/ign-math/branches/compare/flaky_rand_test%0Dign-math2#diff):\r\n\r\n* In [run 62](http://build.osrfoundation.org/view/main/view/CI%20any%20jobs/job/ignition_math-ci-pr_any-homebrew-amd64/62/testReport/%28root%29/RandTest/) and [run 63](http://build.osrfoundation.org/view/main/view/CI%20any%20jobs/job/ignition_math-ci-pr_any-homebrew-amd64/63/testReport/%28root%29/RandTest/), the test completes one time and asserts one time. Thus [test_ran](http://build.osrfoundation.org/view/main/view/CI%20any%20jobs/job/ignition_math-ci-pr_any-homebrew-amd64/63/testReport/%28root%29/RandTest/test_ran/) is marked as a flaky pass. Note also that `test_ran` is listed in the same `RandTest` grouping since a matching `classname` is added in the flaky case.\r\n\r\n* In [run 64](http://build.osrfoundation.org/view/main/view/CI%20any%20jobs/job/ignition_math-ci-pr_any-homebrew-amd64/64/testReport/junit/%28root%29/Results/test_ran/), the test fails both times and is listed under the `Results` class as usual.\r\n\r\n", "title": "Rerun failed tests in gazebo homebrew (#60, #65)", "destination": {"commit": {"hash": "c7ee5bc10706", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/release-tools/commit/c7ee5bc10706.json"}, "html": {"href": "#!/osrf/release-tools/commits/c7ee5bc10706"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/release-tools.json"}, "html": {"href": "#!/osrf/release-tools"}, "avatar": {"href": "data/bytebucket.org/ravatar/{41811d3d-19d0-428e-a134-976595e72508}ts=python"}}, "type": "repository", "name": "release-tools", "full_name": "osrf/release-tools", "uuid": "{41811d3d-19d0-428e-a134-976595e72508}"}, "branch": {"name": "default"}}, "reason": "", "source": {"commit": {"hash": "3d4b719be5fd", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/release-tools/commit/3d4b719be5fd.json"}, "html": {"href": "#!/osrf/release-tools/commits/3d4b719be5fd"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/release-tools.json"}, "html": {"href": "#!/osrf/release-tools"}, "avatar": {"href": "data/bytebucket.org/ravatar/{41811d3d-19d0-428e-a134-976595e72508}ts=python"}}, "type": "repository", "name": "release-tools", "full_name": "osrf/release-tools", "uuid": "{41811d3d-19d0-428e-a134-976595e72508}"}, "branch": {"name": "flaky"}}, "state": "OPEN", "author": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "date": "2016-04-06T17:29:42.373164+00:00"}, "pull_request": {"type": "pullrequest", "id": 209, "links": {"self": {"href": "data/repositories/osrf/release-tools/pullrequests/209.json"}, "html": {"href": "#!/osrf/release-tools/pull-requests/209"}}, "title": "Rerun failed tests in gazebo homebrew (#60, #65)"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/release-tools/pullrequests/209/comments/16828484.json"}, "html": {"href": "#!/osrf/release-tools/pull-requests/209/_/diff#comment-16828484"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 209, "links": {"self": {"href": "data/repositories/osrf/release-tools/pullrequests/209.json"}, "html": {"href": "#!/osrf/release-tools/pull-requests/209"}}, "title": "Rerun failed tests in gazebo homebrew (#60, #65)"}, "content": {"raw": "This is on hold while I report the flaky test handler plugin failure (so meta). I've started two new jenkins builds since the previous results have been deleted.\n\n* http://build.osrfoundation.org/job/gazebo-ci-pr_any-trusty-amd64-gpu-nvidia_flaky/1/\n* http://build.osrfoundation.org/job/gazebo-ci-pr_any-homebrew-amd64_flaky/1/", "markup": "markdown", "html": "<p>This is on hold while I report the flaky test handler plugin failure (so meta). I've started two new jenkins builds since the previous results have been deleted.</p>\n<ul>\n<li><a href=\"http://build.osrfoundation.org/job/gazebo-ci-pr_any-trusty-amd64-gpu-nvidia_flaky/1/\" rel=\"nofollow\" class=\"ap-connect-link\">http://build.osrfoundation.org/job/gazebo-ci-pr_any-trusty-amd64-gpu-nvidia_flaky/1/</a></li>\n<li><a href=\"http://build.osrfoundation.org/job/gazebo-ci-pr_any-homebrew-amd64_flaky/1/\" rel=\"nofollow\" class=\"ap-connect-link\">http://build.osrfoundation.org/job/gazebo-ci-pr_any-homebrew-amd64_flaky/1/</a></li>\n</ul>", "type": "rendered"}, "created_on": "2016-04-06T00:35:54.553817+00:00", "user": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "updated_on": "2016-04-06T00:35:54.556397+00:00", "type": "pullrequest_comment", "id": 16828484}, "pull_request": {"type": "pullrequest", "id": 209, "links": {"self": {"href": "data/repositories/osrf/release-tools/pullrequests/209.json"}, "html": {"href": "#!/osrf/release-tools/pull-requests/209"}}, "title": "Rerun failed tests in gazebo homebrew (#60, #65)"}}, {"update": {"description": "## Summary\r\n\r\nThis PR adds a form of flaky test detection to the gazebo homebrew build (for gazebo7 and up, since older versions of gazebo have many failing tests) by re-running failed tests one time to see if they fail both times (issue #60). This makes use of the `--rerun-failed` argument to ctest, which requires cmake 3+. This is available on homebrew and vivid+ but not trusty by default.\r\n\r\nWhen re-running the failed tests, the `test_results` folder needs to be shuffled and the new junit files merged with the previous version using the `flaky_junit_merge.py` script from previous pull requests. The information about flaky tests can be visualized with the jenkins flaky test plugin, which is already installed in jenkins and is enabled in the dsl with this pull request. [Here's an example of a build with flaky test information](http://build.osrfoundation.org/view/main/view/CI%20any%20jobs/job/ignition_math-ci-pr_any-homebrew-amd64/45/testReport/%28root%29/). Unfortunately it doesn't display anything on the It doesn't display anything on the\r\n[Test Results summary page](http://build.osrfoundation.org/view/main/view/CI%20any%20jobs/job/ignition_math-ci-pr_any-homebrew-amd64/45/testReport/),\r\nbut if you click on\r\n[(root)](http://build.osrfoundation.org/view/main/view/CI%20any%20jobs/job/ignition_math-ci-pr_any-homebrew-amd64/45/testReport/%28root%29/)\r\nit will show info about flaky tests.\r\nLook for a storm cloud to see tests that didn't pass perfectly.\r\n\r\nOne concern about the flaky test plugin is that I have observed some jenkins failures in the gazebo test builds with this branch:\r\n\r\n* http://build.osrfoundation.org/job/gazebo-ci-pr_any-homebrew-amd64/282/\r\n* http://build.osrfoundation.org/job/gazebo-ci-pr_any-homebrew-amd64/284/\r\n\r\n~~~\r\nRecording test results\r\nERROR: Build step failed with exception\r\njava.lang.NullPointerException\r\n\tat java.io.File.<init>(File.java:277)\r\n\tat com.google.jenkins.flakyTestHandler.junit.FlakyTestResult.<init>(FlakyTestResult.java:120)\r\n~~~\r\n\r\nI rebooted the machine and am watching to see if this failure recurs.\r\n\r\n## Tests that fail to run\r\n\r\nThe `flaky_junit_merge.py` script was updated in pull request #214 to resolve #65.\r\n\r\nOne challenge with tests that fail to run is that `ctest --rerun-failed` won't re-run the `check_test_ran` script, so we wouldn't know if the test failed on the second try. There is a hack in  5aacd8d with `sed` and `grep` and a `make test` loop that is not pretty but is working.\r\n\r\nHere are some example builds that show flaky versions of `test_ran` from [ign-math branch flaky_rand_test](https://bitbucket.org/ignitionrobotics/ign-math/branches/compare/flaky_rand_test%0Dign-math2#diff):\r\n\r\n* In [run 62](http://build.osrfoundation.org/view/main/view/CI%20any%20jobs/job/ignition_math-ci-pr_any-homebrew-amd64/62/testReport/%28root%29/RandTest/) and [run 63](http://build.osrfoundation.org/view/main/view/CI%20any%20jobs/job/ignition_math-ci-pr_any-homebrew-amd64/63/testReport/%28root%29/RandTest/), the test completes one time and asserts one time. Thus [test_ran](http://build.osrfoundation.org/view/main/view/CI%20any%20jobs/job/ignition_math-ci-pr_any-homebrew-amd64/63/testReport/%28root%29/RandTest/test_ran/) is marked as a flaky pass. Note also that `test_ran` is listed in the same `RandTest` grouping since a matching `classname` is added in the flaky case.\r\n\r\n* In [run 64](http://build.osrfoundation.org/view/main/view/CI%20any%20jobs/job/ignition_math-ci-pr_any-homebrew-amd64/64/testReport/junit/%28root%29/Results/test_ran/), the test fails both times and is listed under the `Results` class as usual.\r\n\r\n", "title": "Rerun failed tests in gazebo homebrew (#60, #65)", "destination": {"commit": {"hash": "c7ee5bc10706", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/release-tools/commit/c7ee5bc10706.json"}, "html": {"href": "#!/osrf/release-tools/commits/c7ee5bc10706"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/release-tools.json"}, "html": {"href": "#!/osrf/release-tools"}, "avatar": {"href": "data/bytebucket.org/ravatar/{41811d3d-19d0-428e-a134-976595e72508}ts=python"}}, "type": "repository", "name": "release-tools", "full_name": "osrf/release-tools", "uuid": "{41811d3d-19d0-428e-a134-976595e72508}"}, "branch": {"name": "default"}}, "reason": "", "source": {"commit": {"hash": "4866500a1639", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/release-tools/commit/4866500a1639.json"}, "html": {"href": "#!/osrf/release-tools/commits/4866500a1639"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/release-tools.json"}, "html": {"href": "#!/osrf/release-tools"}, "avatar": {"href": "data/bytebucket.org/ravatar/{41811d3d-19d0-428e-a134-976595e72508}ts=python"}}, "type": "repository", "name": "release-tools", "full_name": "osrf/release-tools", "uuid": "{41811d3d-19d0-428e-a134-976595e72508}"}, "branch": {"name": "flaky"}}, "state": "OPEN", "author": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "date": "2016-04-05T21:35:47.319769+00:00"}, "pull_request": {"type": "pullrequest", "id": 209, "links": {"self": {"href": "data/repositories/osrf/release-tools/pullrequests/209.json"}, "html": {"href": "#!/osrf/release-tools/pull-requests/209"}}, "title": "Rerun failed tests in gazebo homebrew (#60, #65)"}}, {"update": {"description": "## Summary\r\n\r\nThis PR adds a form of flaky test detection to the gazebo homebrew build (for gazebo7 and up, since older versions of gazebo have many failing tests) by re-running failed tests one time to see if they fail both times (issue #60). This makes use of the `--rerun-failed` argument to ctest, which requires cmake 3+. This is available on homebrew and vivid+ but not trusty by default.\r\n\r\nWhen re-running the failed tests, the `test_results` folder needs to be shuffled and the new junit files merged with the previous version using the `flaky_junit_merge.py` script from previous pull requests. The information about flaky tests can be visualized with the jenkins flaky test plugin, which is already installed in jenkins and is enabled in the dsl with this pull request. [Here's an example of a build with flaky test information](http://build.osrfoundation.org/view/main/view/CI%20any%20jobs/job/ignition_math-ci-pr_any-homebrew-amd64/45/testReport/%28root%29/). Unfortunately it doesn't display anything on the It doesn't display anything on the\r\n[Test Results summary page](http://build.osrfoundation.org/view/main/view/CI%20any%20jobs/job/ignition_math-ci-pr_any-homebrew-amd64/45/testReport/),\r\nbut if you click on\r\n[(root)](http://build.osrfoundation.org/view/main/view/CI%20any%20jobs/job/ignition_math-ci-pr_any-homebrew-amd64/45/testReport/%28root%29/)\r\nit will show info about flaky tests.\r\nLook for a storm cloud to see tests that didn't pass perfectly.\r\n\r\nOne concern about the flaky test plugin is that I have observed some jenkins failures in the gazebo test builds with this branch:\r\n\r\n* http://build.osrfoundation.org/job/gazebo-ci-pr_any-homebrew-amd64/282/\r\n* http://build.osrfoundation.org/job/gazebo-ci-pr_any-homebrew-amd64/284/\r\n\r\n~~~\r\nRecording test results\r\nERROR: Build step failed with exception\r\njava.lang.NullPointerException\r\n\tat java.io.File.<init>(File.java:277)\r\n\tat com.google.jenkins.flakyTestHandler.junit.FlakyTestResult.<init>(FlakyTestResult.java:120)\r\n~~~\r\n\r\nI rebooted the machine and am watching to see if this failure recurs.\r\n\r\n## Tests that fail to run\r\n\r\nThe `flaky_junit_merge.py` script was updated in pull request #214 to resolve #65.\r\n\r\nOne challenge with tests that fail to run is that `ctest --rerun-failed` won't re-run the `check_test_ran` script, so we wouldn't know if the test failed on the second try. There is a hack in  5aacd8d with `sed` and `grep` and a `make test` loop that is not pretty but is working.\r\n\r\nHere are some example builds that show flaky versions of `test_ran` from [ign-math branch flaky_rand_test](https://bitbucket.org/ignitionrobotics/ign-math/branches/compare/flaky_rand_test%0Dign-math2#diff):\r\n\r\n* In [run 62](http://build.osrfoundation.org/view/main/view/CI%20any%20jobs/job/ignition_math-ci-pr_any-homebrew-amd64/62/testReport/%28root%29/RandTest/) and [run 63](http://build.osrfoundation.org/view/main/view/CI%20any%20jobs/job/ignition_math-ci-pr_any-homebrew-amd64/63/testReport/%28root%29/RandTest/), the test completes one time and asserts one time. Thus [test_ran](http://build.osrfoundation.org/view/main/view/CI%20any%20jobs/job/ignition_math-ci-pr_any-homebrew-amd64/63/testReport/%28root%29/RandTest/test_ran/) is marked as a flaky pass. Note also that `test_ran` is listed in the same `RandTest` grouping since a matching `classname` is added in the flaky case.\r\n\r\n* In [run 64](http://build.osrfoundation.org/view/main/view/CI%20any%20jobs/job/ignition_math-ci-pr_any-homebrew-amd64/64/testReport/junit/%28root%29/Results/test_ran/), the test fails both times and is listed under the `Results` class as usual.\r\n\r\n", "title": "Rerun failed tests in gazebo homebrew (#60, #65)", "destination": {"commit": {"hash": "c7ee5bc10706", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/release-tools/commit/c7ee5bc10706.json"}, "html": {"href": "#!/osrf/release-tools/commits/c7ee5bc10706"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/release-tools.json"}, "html": {"href": "#!/osrf/release-tools"}, "avatar": {"href": "data/bytebucket.org/ravatar/{41811d3d-19d0-428e-a134-976595e72508}ts=python"}}, "type": "repository", "name": "release-tools", "full_name": "osrf/release-tools", "uuid": "{41811d3d-19d0-428e-a134-976595e72508}"}, "branch": {"name": "default"}}, "reason": "", "source": {"commit": {"hash": "4866500a1639", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/release-tools/commit/4866500a1639.json"}, "html": {"href": "#!/osrf/release-tools/commits/4866500a1639"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/release-tools.json"}, "html": {"href": "#!/osrf/release-tools"}, "avatar": {"href": "data/bytebucket.org/ravatar/{41811d3d-19d0-428e-a134-976595e72508}ts=python"}}, "type": "repository", "name": "release-tools", "full_name": "osrf/release-tools", "uuid": "{41811d3d-19d0-428e-a134-976595e72508}"}, "branch": {"name": "flaky"}}, "state": "OPEN", "author": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "date": "2016-04-05T21:35:46.960810+00:00"}, "pull_request": {"type": "pullrequest", "id": 209, "links": {"self": {"href": "data/repositories/osrf/release-tools/pullrequests/209.json"}, "html": {"href": "#!/osrf/release-tools/pull-requests/209"}}, "title": "Rerun failed tests in gazebo homebrew (#60, #65)"}}, {"update": {"description": "## Summary\r\n\r\nThis PR adds a form of flaky test detection to the gazebo homebrew build (for gazebo7 and up, since older versions of gazebo have many failing tests) by re-running failed tests one time to see if they fail both times (issue #60). This makes use of the `--rerun-failed` argument to ctest, which requires cmake 3+. This is available on homebrew and vivid+ but not trusty by default.\r\n\r\nWhen re-running the failed tests, the `test_results` folder needs to be shuffled and the new junit files merged with the previous version using the `flaky_junit_merge.py` script from previous pull requests. The information about flaky tests can be visualized with the jenkins flaky test plugin, which is already installed in jenkins and is enabled in the dsl with this pull request. [Here's an example of a build with flaky test information](http://build.osrfoundation.org/view/main/view/CI%20any%20jobs/job/ignition_math-ci-pr_any-homebrew-amd64/45/testReport/%28root%29/). Unfortunately it doesn't display anything on the It doesn't display anything on the\r\n[Test Results summary page](http://build.osrfoundation.org/view/main/view/CI%20any%20jobs/job/ignition_math-ci-pr_any-homebrew-amd64/45/testReport/),\r\nbut if you click on\r\n[(root)](http://build.osrfoundation.org/view/main/view/CI%20any%20jobs/job/ignition_math-ci-pr_any-homebrew-amd64/45/testReport/%28root%29/)\r\nit will show info about flaky tests.\r\nLook for a storm cloud to see tests that didn't pass perfectly.\r\n\r\nOne concern about the flaky test plugin is that I have observed some jenkins failures in the gazebo test builds with this branch:\r\n\r\n* http://build.osrfoundation.org/job/gazebo-ci-pr_any-homebrew-amd64/282/\r\n* http://build.osrfoundation.org/job/gazebo-ci-pr_any-homebrew-amd64/284/\r\n\r\n~~~\r\nRecording test results\r\nERROR: Build step failed with exception\r\njava.lang.NullPointerException\r\n\tat java.io.File.<init>(File.java:277)\r\n\tat com.google.jenkins.flakyTestHandler.junit.FlakyTestResult.<init>(FlakyTestResult.java:120)\r\n~~~\r\n\r\nI rebooted the machine and am watching to see if this failure recurs.\r\n\r\n## Tests that fail to run\r\n\r\nThe `flaky_junit_merge.py` script was updated in pull request #214 to resolve #65.\r\n\r\nOne challenge with tests that fail to run is that `ctest --rerun-failed` won't re-run the `check_test_ran` script, so we wouldn't know if the test failed on the second try. There is a hack in  5aacd8d with `sed` and `grep` and a `make test` loop that is not pretty but is working.\r\n\r\nHere are some example builds that show flaky versions of `test_ran` from [ign-math branch flaky_rand_test](https://bitbucket.org/ignitionrobotics/ign-math/branches/compare/flaky_rand_test%0Dign-math2#diff):\r\n\r\n* In [run 62](http://build.osrfoundation.org/view/main/view/CI%20any%20jobs/job/ignition_math-ci-pr_any-homebrew-amd64/62/testReport/%28root%29/RandTest/) and [run 63](http://build.osrfoundation.org/view/main/view/CI%20any%20jobs/job/ignition_math-ci-pr_any-homebrew-amd64/63/testReport/%28root%29/RandTest/), the test completes one time and asserts one time. Thus [test_ran](http://build.osrfoundation.org/view/main/view/CI%20any%20jobs/job/ignition_math-ci-pr_any-homebrew-amd64/63/testReport/%28root%29/RandTest/test_ran/) is marked as a flaky pass. Note also that `test_ran` is listed in the same `RandTest` grouping since a matching `classname` is added in the flaky case.\r\n\r\n* In [run 64](http://build.osrfoundation.org/view/main/view/CI%20any%20jobs/job/ignition_math-ci-pr_any-homebrew-amd64/64/testReport/junit/%28root%29/Results/test_ran/), the test fails both times and is listed under the `Results` class as usual.\r\n\r\n", "title": "Rerun failed tests in gazebo homebrew (#60, #65)", "destination": {"commit": {"hash": "c7ee5bc10706", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/release-tools/commit/c7ee5bc10706.json"}, "html": {"href": "#!/osrf/release-tools/commits/c7ee5bc10706"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/release-tools.json"}, "html": {"href": "#!/osrf/release-tools"}, "avatar": {"href": "data/bytebucket.org/ravatar/{41811d3d-19d0-428e-a134-976595e72508}ts=python"}}, "type": "repository", "name": "release-tools", "full_name": "osrf/release-tools", "uuid": "{41811d3d-19d0-428e-a134-976595e72508}"}, "branch": {"name": "default"}}, "reason": "", "source": {"commit": {"hash": "392d55920aa4", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/release-tools/commit/392d55920aa4.json"}, "html": {"href": "#!/osrf/release-tools/commits/392d55920aa4"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/release-tools.json"}, "html": {"href": "#!/osrf/release-tools"}, "avatar": {"href": "data/bytebucket.org/ravatar/{41811d3d-19d0-428e-a134-976595e72508}ts=python"}}, "type": "repository", "name": "release-tools", "full_name": "osrf/release-tools", "uuid": "{41811d3d-19d0-428e-a134-976595e72508}"}, "branch": {"name": "flaky"}}, "state": "OPEN", "author": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "date": "2016-04-05T20:41:50.375916+00:00"}, "pull_request": {"type": "pullrequest", "id": 209, "links": {"self": {"href": "data/repositories/osrf/release-tools/pullrequests/209.json"}, "html": {"href": "#!/osrf/release-tools/pull-requests/209"}}, "title": "Rerun failed tests in gazebo homebrew (#60, #65)"}}, {"update": {"description": "## Summary\r\n\r\nThis PR adds a form of flaky test detection to the gazebo homebrew build (for gazebo7 and up, since older versions of gazebo have many failing tests) by re-running failed tests one time to see if they fail both times (issue #60). This makes use of the `--rerun-failed` argument to ctest, which requires cmake 3+. This is available on homebrew and vivid+ but not trusty by default.\r\n\r\nWhen re-running the failed tests, the `test_results` folder needs to be shuffled and the new junit files merged with the previous version using the `flaky_junit_merge.py` script from previous pull requests. The information about flaky tests can be visualized with the jenkins flaky test plugin, which is already installed in jenkins and is enabled in the dsl with this pull request. [Here's an example of a build with flaky test information](http://build.osrfoundation.org/view/main/view/CI%20any%20jobs/job/ignition_math-ci-pr_any-homebrew-amd64/45/testReport/%28root%29/). Unfortunately it doesn't display anything on the It doesn't display anything on the\r\n[Test Results summary page](http://build.osrfoundation.org/view/main/view/CI%20any%20jobs/job/ignition_math-ci-pr_any-homebrew-amd64/45/testReport/),\r\nbut if you click on\r\n[(root)](http://build.osrfoundation.org/view/main/view/CI%20any%20jobs/job/ignition_math-ci-pr_any-homebrew-amd64/45/testReport/%28root%29/)\r\nit will show info about flaky tests.\r\nLook for a storm cloud to see tests that didn't pass perfectly.\r\n\r\nOne concern about the flaky test plugin is that I have observed some jenkins failures in the gazebo test builds with this branch:\r\n\r\n* http://build.osrfoundation.org/job/gazebo-ci-pr_any-homebrew-amd64/282/\r\n* http://build.osrfoundation.org/job/gazebo-ci-pr_any-homebrew-amd64/284/\r\n\r\n~~~\r\nRecording test results\r\nERROR: Build step failed with exception\r\njava.lang.NullPointerException\r\n\tat java.io.File.<init>(File.java:277)\r\n\tat com.google.jenkins.flakyTestHandler.junit.FlakyTestResult.<init>(FlakyTestResult.java:120)\r\n~~~\r\n\r\nI rebooted the machine and am watching to see if this failure recurs.\r\n\r\n## Tests that fail to run\r\n\r\nThe `flaky_junit_merge.py` script has not been handling well the case when tests fail to run (#65). In this case, our `check_test_ran.py` script generates a junit file with different `testsuite` and `testcase` names, and also a root tag of `<testsuite>` instead of `<testsuites>`. This PR resolves that issue with more example xml files.\r\n\r\nOne extra challenge is that `ctest --rerun-failed` won't re-run the `check_test_ran` script, so we wouldn't know if the test failed on the second try. There is a hack in  5aacd8d with `sed` and `grep` and a `make test` loop that is not pretty but is working.\r\n\r\nHere are some example builds that show flaky versions of `test_ran` from [ign-math branch flaky_rand_test](https://bitbucket.org/ignitionrobotics/ign-math/branches/compare/flaky_rand_test%0Dign-math2#diff):\r\n\r\n* In [run 62](http://build.osrfoundation.org/view/main/view/CI%20any%20jobs/job/ignition_math-ci-pr_any-homebrew-amd64/62/testReport/%28root%29/RandTest/) and [run 63](http://build.osrfoundation.org/view/main/view/CI%20any%20jobs/job/ignition_math-ci-pr_any-homebrew-amd64/63/testReport/%28root%29/RandTest/), the test completes one time and asserts one time. Thus [test_ran](http://build.osrfoundation.org/view/main/view/CI%20any%20jobs/job/ignition_math-ci-pr_any-homebrew-amd64/63/testReport/%28root%29/RandTest/test_ran/) is marked as a flaky pass. Note also that `test_ran` is listed in the same `RandTest` grouping since a matching `classname` is added in the flaky case.\r\n\r\n* In [run 64](http://build.osrfoundation.org/view/main/view/CI%20any%20jobs/job/ignition_math-ci-pr_any-homebrew-amd64/64/testReport/junit/%28root%29/Results/test_ran/), the test fails both times and is listed under the `Results` class as usual.\r\n\r\n", "title": "Rerun failed tests in gazebo homebrew (#60, #65)", "destination": {"commit": {"hash": "c7ee5bc10706", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/release-tools/commit/c7ee5bc10706.json"}, "html": {"href": "#!/osrf/release-tools/commits/c7ee5bc10706"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/release-tools.json"}, "html": {"href": "#!/osrf/release-tools"}, "avatar": {"href": "data/bytebucket.org/ravatar/{41811d3d-19d0-428e-a134-976595e72508}ts=python"}}, "type": "repository", "name": "release-tools", "full_name": "osrf/release-tools", "uuid": "{41811d3d-19d0-428e-a134-976595e72508}"}, "branch": {"name": "default"}}, "reason": "", "source": {"commit": {"hash": "392d55920aa4", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/release-tools/commit/392d55920aa4.json"}, "html": {"href": "#!/osrf/release-tools/commits/392d55920aa4"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/release-tools.json"}, "html": {"href": "#!/osrf/release-tools"}, "avatar": {"href": "data/bytebucket.org/ravatar/{41811d3d-19d0-428e-a134-976595e72508}ts=python"}}, "type": "repository", "name": "release-tools", "full_name": "osrf/release-tools", "uuid": "{41811d3d-19d0-428e-a134-976595e72508}"}, "branch": {"name": "flaky"}}, "state": "OPEN", "author": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "date": "2016-04-05T20:39:33.617151+00:00"}, "pull_request": {"type": "pullrequest", "id": 209, "links": {"self": {"href": "data/repositories/osrf/release-tools/pullrequests/209.json"}, "html": {"href": "#!/osrf/release-tools/pull-requests/209"}}, "title": "Rerun failed tests in gazebo homebrew (#60, #65)"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/release-tools/pullrequests/209/comments/16734005.json"}, "html": {"href": "#!/osrf/release-tools/pull-requests/209/_/diff#comment-16734005"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 209, "links": {"self": {"href": "data/repositories/osrf/release-tools/pullrequests/209.json"}, "html": {"href": "#!/osrf/release-tools/pull-requests/209"}}, "title": "Rerun failed tests in gazebo homebrew (#60, #65)"}, "content": {"raw": "I split the modifications to `flaky_junit_merge.py` into pull request #214 to break up the review process", "markup": "markdown", "html": "<p>I split the modifications to <code>flaky_junit_merge.py</code> into <a href=\"#!/osrf/release-tools/pull-requests/214/part-of-pull-request-209-merge-junit-files\" rel=\"nofollow\" class=\"ap-connect-link\">pull request #214</a> to break up the review process</p>", "type": "rendered"}, "created_on": "2016-04-04T17:59:20.249480+00:00", "user": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "updated_on": "2016-04-04T17:59:20.251876+00:00", "type": "pullrequest_comment", "id": 16734005}, "pull_request": {"type": "pullrequest", "id": 209, "links": {"self": {"href": "data/repositories/osrf/release-tools/pullrequests/209.json"}, "html": {"href": "#!/osrf/release-tools/pull-requests/209"}}, "title": "Rerun failed tests in gazebo homebrew (#60, #65)"}}, {"update": {"description": "## Summary\r\n\r\nThis PR adds a form of flaky test detection to the gazebo homebrew build (for gazebo7 and up, since older versions of gazebo have many failing tests) by re-running failed tests one time to see if they fail both times (issue #60). This makes use of the `--rerun-failed` argument to ctest, which requires cmake 3+. This is available on homebrew and vivid+ but not trusty by default.\r\n\r\nWhen re-running the failed tests, the `test_results` folder needs to be shuffled and the new junit files merged with the previous version using the `flaky_junit_merge.py` script from previous pull requests. The information about flaky tests can be visualized with the jenkins flaky test plugin, which is already installed in jenkins and is enabled in the dsl with this pull request. [Here's an example of a build with flaky test information](http://build.osrfoundation.org/view/main/view/CI%20any%20jobs/job/ignition_math-ci-pr_any-homebrew-amd64/45/testReport/%28root%29/). Unfortunately it doesn't display anything on the It doesn't display anything on the\r\n[Test Results summary page](http://build.osrfoundation.org/view/main/view/CI%20any%20jobs/job/ignition_math-ci-pr_any-homebrew-amd64/45/testReport/),\r\nbut if you click on\r\n[(root)](http://build.osrfoundation.org/view/main/view/CI%20any%20jobs/job/ignition_math-ci-pr_any-homebrew-amd64/45/testReport/%28root%29/)\r\nit will show info about flaky tests.\r\nLook for a storm cloud to see tests that didn't pass perfectly.\r\n\r\nOne concern about the flaky test plugin is that I have observed some jenkins failures in the gazebo test builds with this branch:\r\n\r\n* http://build.osrfoundation.org/job/gazebo-ci-pr_any-homebrew-amd64/282/\r\n* http://build.osrfoundation.org/job/gazebo-ci-pr_any-homebrew-amd64/284/\r\n\r\n~~~\r\nRecording test results\r\nERROR: Build step failed with exception\r\njava.lang.NullPointerException\r\n\tat java.io.File.<init>(File.java:277)\r\n\tat com.google.jenkins.flakyTestHandler.junit.FlakyTestResult.<init>(FlakyTestResult.java:120)\r\n~~~\r\n\r\nI rebooted the machine and am watching to see if this failure recurs.\r\n\r\n## Tests that fail to run\r\n\r\nThe `flaky_junit_merge.py` script has not been handling well the case when tests fail to run (#65). In this case, our `check_test_ran.py` script generates a junit file with different `testsuite` and `testcase` names, and also a root tag of `<testsuite>` instead of `<testsuites>`. This PR resolves that issue with more example xml files.\r\n\r\nOne extra challenge is that `ctest --rerun-failed` won't re-run the `check_test_ran` script, so we wouldn't know if the test failed on the second try. There is a hack in  5aacd8d with `sed` and `grep` and a `make test` loop that is not pretty but is working.\r\n\r\nHere are some example builds that show flaky versions of `test_ran` from [ign-math branch flaky_rand_test](https://bitbucket.org/ignitionrobotics/ign-math/branches/compare/flaky_rand_test%0Dign-math2#diff):\r\n\r\n* In [run 62](http://build.osrfoundation.org/view/main/view/CI%20any%20jobs/job/ignition_math-ci-pr_any-homebrew-amd64/62/testReport/%28root%29/RandTest/) and [run 63](http://build.osrfoundation.org/view/main/view/CI%20any%20jobs/job/ignition_math-ci-pr_any-homebrew-amd64/63/testReport/%28root%29/RandTest/), the test completes one time and asserts one time. Thus [test_ran](http://build.osrfoundation.org/view/main/view/CI%20any%20jobs/job/ignition_math-ci-pr_any-homebrew-amd64/63/testReport/%28root%29/RandTest/test_ran/) is marked as a flaky pass. Note also that `test_ran` is listed in the same `RandTest` grouping since a matching `classname` is added in the flaky case.\r\n\r\n* In [run 64](http://build.osrfoundation.org/view/main/view/CI%20any%20jobs/job/ignition_math-ci-pr_any-homebrew-amd64/64/testReport/junit/%28root%29/Results/test_ran/), the test fails both times and is listed under the `Results` class as usual.\r\n\r\n", "title": "Rerun failed tests in gazebo homebrew (#60, #65)", "destination": {"commit": {"hash": "1a51f7ecf6ec", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/release-tools/commit/1a51f7ecf6ec.json"}, "html": {"href": "#!/osrf/release-tools/commits/1a51f7ecf6ec"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/release-tools.json"}, "html": {"href": "#!/osrf/release-tools"}, "avatar": {"href": "data/bytebucket.org/ravatar/{41811d3d-19d0-428e-a134-976595e72508}ts=python"}}, "type": "repository", "name": "release-tools", "full_name": "osrf/release-tools", "uuid": "{41811d3d-19d0-428e-a134-976595e72508}"}, "branch": {"name": "default"}}, "reason": "", "source": {"commit": {"hash": "238bddeecc7e", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/release-tools/commit/238bddeecc7e.json"}, "html": {"href": "#!/osrf/release-tools/commits/238bddeecc7e"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/release-tools.json"}, "html": {"href": "#!/osrf/release-tools"}, "avatar": {"href": "data/bytebucket.org/ravatar/{41811d3d-19d0-428e-a134-976595e72508}ts=python"}}, "type": "repository", "name": "release-tools", "full_name": "osrf/release-tools", "uuid": "{41811d3d-19d0-428e-a134-976595e72508}"}, "branch": {"name": "flaky"}}, "state": "OPEN", "author": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "date": "2016-04-01T22:02:02.870550+00:00"}, "pull_request": {"type": "pullrequest", "id": 209, "links": {"self": {"href": "data/repositories/osrf/release-tools/pullrequests/209.json"}, "html": {"href": "#!/osrf/release-tools/pull-requests/209"}}, "title": "Rerun failed tests in gazebo homebrew (#60, #65)"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/release-tools/pullrequests/209/comments/16549200.json"}, "html": {"href": "#!/osrf/release-tools/pull-requests/209/_/diff#comment-16549200"}}, "parent": {"id": 16546365, "links": {"self": {"href": "data/repositories/osrf/release-tools/pullrequests/209/comments/16546365.json"}, "html": {"href": "#!/osrf/release-tools/pull-requests/209/_/diff#comment-16546365"}}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 209, "links": {"self": {"href": "data/repositories/osrf/release-tools/pullrequests/209.json"}, "html": {"href": "#!/osrf/release-tools/pull-requests/209"}}, "title": "Rerun failed tests in gazebo homebrew (#60, #65)"}, "content": {"raw": "although this job has the `OutOfMemoryError`, but not the `NullPointerException`. Maybe they aren't related.", "markup": "markdown", "html": "<p>although this job has the <code>OutOfMemoryError</code>, but not the <code>NullPointerException</code>. Maybe they aren't related.</p>", "type": "rendered"}, "created_on": "2016-03-31T22:30:23.030963+00:00", "user": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "updated_on": "2016-03-31T22:30:23.033032+00:00", "type": "pullrequest_comment", "id": 16549200}, "pull_request": {"type": "pullrequest", "id": 209, "links": {"self": {"href": "data/repositories/osrf/release-tools/pullrequests/209.json"}, "html": {"href": "#!/osrf/release-tools/pull-requests/209"}}, "title": "Rerun failed tests in gazebo homebrew (#60, #65)"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/release-tools/pullrequests/209/comments/16546365.json"}, "html": {"href": "#!/osrf/release-tools/pull-requests/209/_/diff#comment-16546365"}}, "parent": {"id": 16546168, "links": {"self": {"href": "data/repositories/osrf/release-tools/pullrequests/209/comments/16546168.json"}, "html": {"href": "#!/osrf/release-tools/pull-requests/209/_/diff#comment-16546168"}}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 209, "links": {"self": {"href": "data/repositories/osrf/release-tools/pullrequests/209.json"}, "html": {"href": "#!/osrf/release-tools/pull-requests/209"}}, "title": "Rerun failed tests in gazebo homebrew (#60, #65)"}, "content": {"raw": "I also see `java.lang.OutOfMemoryError: Java heap space`\n", "markup": "markdown", "html": "<p>I also see <code>java.lang.OutOfMemoryError: Java heap space</code></p>", "type": "rendered"}, "created_on": "2016-03-31T21:08:08.415165+00:00", "user": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "updated_on": "2016-03-31T21:08:08.417437+00:00", "type": "pullrequest_comment", "id": 16546365}, "pull_request": {"type": "pullrequest", "id": 209, "links": {"self": {"href": "data/repositories/osrf/release-tools/pullrequests/209.json"}, "html": {"href": "#!/osrf/release-tools/pull-requests/209"}}, "title": "Rerun failed tests in gazebo homebrew (#60, #65)"}}, {"comment": {"links": {"self": {"href": "data/repositories/osrf/release-tools/pullrequests/209/comments/16546168.json"}, "html": {"href": "#!/osrf/release-tools/pull-requests/209/_/diff#comment-16546168"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 209, "links": {"self": {"href": "data/repositories/osrf/release-tools/pullrequests/209.json"}, "html": {"href": "#!/osrf/release-tools/pull-requests/209"}}, "title": "Rerun failed tests in gazebo homebrew (#60, #65)"}, "content": {"raw": "It looks like the failures from the `flakyTestHandler` are still happening. We should figure this out before merging.\n\n* http://build.osrfoundation.org/job/gazebo-ci-pr_any-homebrew-amd64/289/", "markup": "markdown", "html": "<p>It looks like the failures from the <code>flakyTestHandler</code> are still happening. We should figure this out before merging.</p>\n<ul>\n<li><a href=\"http://build.osrfoundation.org/job/gazebo-ci-pr_any-homebrew-amd64/289/\" rel=\"nofollow\" class=\"ap-connect-link\">http://build.osrfoundation.org/job/gazebo-ci-pr_any-homebrew-amd64/289/</a></li>\n</ul>", "type": "rendered"}, "created_on": "2016-03-31T21:01:18.208614+00:00", "user": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "updated_on": "2016-03-31T21:01:18.211292+00:00", "type": "pullrequest_comment", "id": 16546168}, "pull_request": {"type": "pullrequest", "id": 209, "links": {"self": {"href": "data/repositories/osrf/release-tools/pullrequests/209.json"}, "html": {"href": "#!/osrf/release-tools/pull-requests/209"}}, "title": "Rerun failed tests in gazebo homebrew (#60, #65)"}}, {"update": {"description": "## Summary\r\n\r\nThis PR adds a form of flaky test detection to the gazebo homebrew build (for gazebo7 and up, since older versions of gazebo have many failing tests) by re-running failed tests one time to see if they fail both times (issue #60). This makes use of the `--rerun-failed` argument to ctest, which requires cmake 3+. This is available on homebrew and vivid+ but not trusty by default.\r\n\r\nWhen re-running the failed tests, the `test_results` folder needs to be shuffled and the new junit files merged with the previous version using the `flaky_junit_merge.py` script from previous pull requests. The information about flaky tests can be visualized with the jenkins flaky test plugin, which is already installed in jenkins and is enabled in the dsl with this pull request. [Here's an example of a build with flaky test information](http://build.osrfoundation.org/view/main/view/CI%20any%20jobs/job/ignition_math-ci-pr_any-homebrew-amd64/45/testReport/%28root%29/). Unfortunately it doesn't display anything on the It doesn't display anything on the\r\n[Test Results summary page](http://build.osrfoundation.org/view/main/view/CI%20any%20jobs/job/ignition_math-ci-pr_any-homebrew-amd64/45/testReport/),\r\nbut if you click on\r\n[(root)](http://build.osrfoundation.org/view/main/view/CI%20any%20jobs/job/ignition_math-ci-pr_any-homebrew-amd64/45/testReport/%28root%29/)\r\nit will show info about flaky tests.\r\nLook for a storm cloud to see tests that didn't pass perfectly.\r\n\r\nOne concern about the flaky test plugin is that I have observed some jenkins failures in the gazebo test builds with this branch:\r\n\r\n* http://build.osrfoundation.org/job/gazebo-ci-pr_any-homebrew-amd64/282/\r\n* http://build.osrfoundation.org/job/gazebo-ci-pr_any-homebrew-amd64/284/\r\n\r\n~~~\r\nRecording test results\r\nERROR: Build step failed with exception\r\njava.lang.NullPointerException\r\n\tat java.io.File.<init>(File.java:277)\r\n\tat com.google.jenkins.flakyTestHandler.junit.FlakyTestResult.<init>(FlakyTestResult.java:120)\r\n~~~\r\n\r\nI rebooted the machine and am watching to see if this failure recurs.\r\n\r\n## Tests that fail to run\r\n\r\nThe `flaky_junit_merge.py` script has not been handling well the case when tests fail to run (#65). In this case, our `check_test_ran.py` script generates a junit file with different `testsuite` and `testcase` names, and also a root tag of `<testsuite>` instead of `<testsuites>`. This PR resolves that issue with more example xml files.\r\n\r\nOne extra challenge is that `ctest --rerun-failed` won't re-run the `check_test_ran` script, so we wouldn't know if the test failed on the second try. There is a hack in  5aacd8d with `sed` and `grep` and a `make test` loop that is not pretty but is working.\r\n\r\nHere are some example builds that show flaky versions of `test_ran` from [ign-math branch flaky_rand_test](https://bitbucket.org/ignitionrobotics/ign-math/branches/compare/flaky_rand_test%0Dign-math2#diff):\r\n\r\n* In [run 62](http://build.osrfoundation.org/view/main/view/CI%20any%20jobs/job/ignition_math-ci-pr_any-homebrew-amd64/62/testReport/%28root%29/RandTest/) and [run 63](http://build.osrfoundation.org/view/main/view/CI%20any%20jobs/job/ignition_math-ci-pr_any-homebrew-amd64/63/testReport/%28root%29/RandTest/), the test completes one time and asserts one time. Thus [test_ran](http://build.osrfoundation.org/view/main/view/CI%20any%20jobs/job/ignition_math-ci-pr_any-homebrew-amd64/63/testReport/%28root%29/RandTest/test_ran/) is marked as a flaky pass. Note also that `test_ran` is listed in the same `RandTest` grouping since a matching `classname` is added in the flaky case.\r\n\r\n* In [run 64](http://build.osrfoundation.org/view/main/view/CI%20any%20jobs/job/ignition_math-ci-pr_any-homebrew-amd64/64/testReport/junit/%28root%29/Results/test_ran/), the test fails both times and is listed under the `Results` class as usual.\r\n\r\n", "title": "Rerun failed tests in gazebo homebrew (#60, #65)", "destination": {"commit": {"hash": "6bfbeb2d769a", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/release-tools/commit/6bfbeb2d769a.json"}, "html": {"href": "#!/osrf/release-tools/commits/6bfbeb2d769a"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/release-tools.json"}, "html": {"href": "#!/osrf/release-tools"}, "avatar": {"href": "data/bytebucket.org/ravatar/{41811d3d-19d0-428e-a134-976595e72508}ts=python"}}, "type": "repository", "name": "release-tools", "full_name": "osrf/release-tools", "uuid": "{41811d3d-19d0-428e-a134-976595e72508}"}, "branch": {"name": "default"}}, "reason": "", "source": {"commit": {"hash": "c3e7d4ebaa92", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/release-tools/commit/c3e7d4ebaa92.json"}, "html": {"href": "#!/osrf/release-tools/commits/c3e7d4ebaa92"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/release-tools.json"}, "html": {"href": "#!/osrf/release-tools"}, "avatar": {"href": "data/bytebucket.org/ravatar/{41811d3d-19d0-428e-a134-976595e72508}ts=python"}}, "type": "repository", "name": "release-tools", "full_name": "osrf/release-tools", "uuid": "{41811d3d-19d0-428e-a134-976595e72508}"}, "branch": {"name": "flaky"}}, "state": "OPEN", "author": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "date": "2016-03-31T18:40:09.138370+00:00"}, "pull_request": {"type": "pullrequest", "id": 209, "links": {"self": {"href": "data/repositories/osrf/release-tools/pullrequests/209.json"}, "html": {"href": "#!/osrf/release-tools/pull-requests/209"}}, "title": "Rerun failed tests in gazebo homebrew (#60, #65)"}}, {"update": {"description": "## Summary\r\n\r\nThis PR adds a form of flaky test detection to the gazebo homebrew build (for gazebo7 and up, since older versions of gazebo have many failing tests) by re-running failed tests one time to see if they fail both times (issue #60). This makes use of the `--rerun-failed` argument to ctest, which requires cmake 3+. This is available on homebrew and vivid+ but not trusty by default.\r\n\r\nWhen re-running the failed tests, the `test_results` folder needs to be shuffled and the new junit files merged with the previous version using the `flaky_junit_merge.py` script from previous pull requests. The information about flaky tests can be visualized with the jenkins flaky test plugin, which is already installed in jenkins and is enabled in the dsl with this pull request. [Here's an example of a build with flaky test information](http://build.osrfoundation.org/view/main/view/CI%20any%20jobs/job/ignition_math-ci-pr_any-homebrew-amd64/45/testReport/%28root%29/). Unfortunately it doesn't display anything on the It doesn't display anything on the\r\n[Test Results summary page](http://build.osrfoundation.org/view/main/view/CI%20any%20jobs/job/ignition_math-ci-pr_any-homebrew-amd64/45/testReport/),\r\nbut if you click on\r\n[(root)](http://build.osrfoundation.org/view/main/view/CI%20any%20jobs/job/ignition_math-ci-pr_any-homebrew-amd64/45/testReport/%28root%29/)\r\nit will show info about flaky tests.\r\nLook for a storm cloud to see tests that didn't pass perfectly.\r\n\r\nOne concern about the flaky test plugin is that I have observed some jenkins failures in the gazebo test builds with this branch:\r\n\r\n* http://build.osrfoundation.org/job/gazebo-ci-pr_any-homebrew-amd64/282/\r\n* http://build.osrfoundation.org/job/gazebo-ci-pr_any-homebrew-amd64/284/\r\n\r\n~~~\r\nRecording test results\r\nERROR: Build step failed with exception\r\njava.lang.NullPointerException\r\n\tat java.io.File.<init>(File.java:277)\r\n\tat com.google.jenkins.flakyTestHandler.junit.FlakyTestResult.<init>(FlakyTestResult.java:120)\r\n~~~\r\n\r\nI rebooted the machine and am watching to see if this failure recurs.\r\n\r\n## Tests that fail to run\r\n\r\nThe `flaky_junit_merge.py` script has not been handling well the case when tests fail to run (#65). In this case, our `check_test_ran.py` script generates a junit file with different `testsuite` and `testcase` names, and also a root tag of `<testsuite>` instead of `<testsuites>`. This PR resolves that issue with more example xml files.\r\n\r\nOne extra challenge is that `ctest --rerun-failed` won't re-run the `check_test_ran` script, so we wouldn't know if the test failed on the second try. There is a hack in  5aacd8d with `sed` and `grep` and a `make test` loop that is not pretty but is working.\r\n\r\nHere are some example builds that show flaky versions of `test_ran` from [ign-math branch flaky_rand_test](https://bitbucket.org/ignitionrobotics/ign-math/branches/compare/flaky_rand_test%0Dign-math2#diff):\r\n\r\n* In [run 62](http://build.osrfoundation.org/view/main/view/CI%20any%20jobs/job/ignition_math-ci-pr_any-homebrew-amd64/62/testReport/%28root%29/RandTest/) and [run 63](http://build.osrfoundation.org/view/main/view/CI%20any%20jobs/job/ignition_math-ci-pr_any-homebrew-amd64/63/testReport/%28root%29/RandTest/), the test completes one time and asserts one time. Thus [test_ran](http://build.osrfoundation.org/view/main/view/CI%20any%20jobs/job/ignition_math-ci-pr_any-homebrew-amd64/63/testReport/%28root%29/RandTest/test_ran/) is marked as a flaky pass. Note also that `test_ran` is listed in the same `RandTest` grouping since a matching `classname` is added in the flaky case.\r\n\r\n* In [run 64](http://build.osrfoundation.org/view/main/view/CI%20any%20jobs/job/ignition_math-ci-pr_any-homebrew-amd64/64/testReport/junit/%28root%29/Results/test_ran/), the test fails both times and is listed under the `Results` class as usual.\r\n\r\n", "title": "Rerun failed tests in gazebo homebrew (#60, #65)", "destination": {"commit": {"hash": "6bfbeb2d769a", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/release-tools/commit/6bfbeb2d769a.json"}, "html": {"href": "#!/osrf/release-tools/commits/6bfbeb2d769a"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/release-tools.json"}, "html": {"href": "#!/osrf/release-tools"}, "avatar": {"href": "data/bytebucket.org/ravatar/{41811d3d-19d0-428e-a134-976595e72508}ts=python"}}, "type": "repository", "name": "release-tools", "full_name": "osrf/release-tools", "uuid": "{41811d3d-19d0-428e-a134-976595e72508}"}, "branch": {"name": "default"}}, "reason": "", "source": {"commit": {"hash": "c3e7d4ebaa92", "type": "commit", "links": {"self": {"href": "data/repositories/osrf/release-tools/commit/c3e7d4ebaa92.json"}, "html": {"href": "#!/osrf/release-tools/commits/c3e7d4ebaa92"}}}, "repository": {"links": {"self": {"href": "data/repositories/osrf/release-tools.json"}, "html": {"href": "#!/osrf/release-tools"}, "avatar": {"href": "data/bytebucket.org/ravatar/{41811d3d-19d0-428e-a134-976595e72508}ts=python"}}, "type": "repository", "name": "release-tools", "full_name": "osrf/release-tools", "uuid": "{41811d3d-19d0-428e-a134-976595e72508}"}, "branch": {"name": "flaky"}}, "state": "OPEN", "author": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "date": "2016-03-31T18:40:09.098870+00:00"}, "pull_request": {"type": "pullrequest", "id": 209, "links": {"self": {"href": "data/repositories/osrf/release-tools/pullrequests/209.json"}, "html": {"href": "#!/osrf/release-tools/pull-requests/209"}}, "title": "Rerun failed tests in gazebo homebrew (#60, #65)"}}]}